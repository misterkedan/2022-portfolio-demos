(()=>{"use strict";const t=THREE;function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var n=function(){function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.callbacks="function"==typeof r?[r]:r,this.fps=n,this.elapsed=0,this._last=0,this._deltaOffset=0,this._isPlaying=!1,this._update=this.update.bind(this)}var n,i,o;return n=t,(i=[{key:"add",value:function(t){this.has(t)||this.callbacks.push(t)}},{key:"remove",value:function(t){this.has(t)&&this.callbacks.splice(this.callbacks.indexOf(t),1)}},{key:"has",value:function(t){return this.callbacks.includes(t)}},{key:"reset",value:function(){this.elapsed=0}},{key:"start",value:function(){this._last=this.now,this._deltaOffset=0,this._isPlaying=!0,this.requestFrame()}},{key:"pause",value:function(){this._isPlaying=!1}},{key:"stop",value:function(){this.pause(),this.reset()}},{key:"update",value:function(){if(this.isPlaying){this.requestFrame();var e=Math.min(this.now-this._last,t.maxDelta);if(this._last=this.now,this.elapsed+=e,e>=this._frameDuration)return this.tick(e);this._deltaOffset+=e;var r=this._frameDuration-this._deltaOffset;r<=0&&(this.tick(this._frameDuration),this._deltaOffset=Math.abs(r)%this._frameDuration)}}},{key:"tick",value:function(t){var e=this;this.callbacks.forEach((function(r){return r(t,e.elapsed)}))}},{key:"requestFrame",value:function(){requestAnimationFrame(this._update)}},{key:"fps",get:function(){return this._fps},set:function(t){this._fps=t,this._frameDuration=t>0?Math.floor(1e3/t):0}},{key:"isPlaying",get:function(){return this._isPlaying}},{key:"now",get:function(){return t.time.now()}}])&&r(n.prototype,i),o&&r(n,o),Object.defineProperty(n,"prototype",{writable:!1}),t}();function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}n.maxDelta=100,n.time=Date||performance;var a=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=r.container,a=void 0===o?"sketch":o,s=r.width,l=r.height,u=r.fps,c=r.renderer,f=void 0===c?new t.WebGLRenderer({powerPreference:"high-performance",antialias:!1,stencil:!1,depth:!1}):c,h=r.debug,d=r.stats;if(i(this,e),this.renderer=f,this.canvas=f.domElement,this.pixelRatio=Math.min(window.devicePixelRatio,2),"string"==typeof a&&(a=document.getElementById(a)),a||(a=document.body),a.appendChild(this.canvas),a.style.touchAction="none",this.width=s>0?s:void 0,this.height=l>0?l:void 0,this.debug=h,this.fps=h?0:u,this.ticker=new n(this.tick.bind(this),u),d||h){this.stats=new e.Stats,a.appendChild(this.stats.domElement);var p=function(){this.stats.update()}.bind(this);this.ticker.add(p)}}var r,a,s;return r=e,a=[{key:"init",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sketch;this.sketch=t,this.resize(),this.sketch.init(),this.onResize=function(){this.needsResize=!0}.bind(this),window.addEventListener("resize",this.onResize),this.onTouchStart=function(t){return t.preventDefault()},this.canvas.addEventListener("touchstart",this.onTouchStart),this.tick(0,0),this.ticker.start()}},{key:"dispose",value:function(){this.ticker.stop(),window.removeEventListener("resize",this.onResize),window.removeEventListener("touchstart",this.onTouchStart)}},{key:"resize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.width,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.height;t||(t=window.innerWidth),e||(e=window.innerHeight),this.renderer.setPixelRatio(this.pixelRatio),this.renderer.setSize(t,e),this.sketch.resize(t,e,this.pixelRatio),this.wide=t>1e3,this.needsResize=!1}},{key:"tick",value:function(t,e){this.needsResize&&this.resize(),this.sketch.tick(t,e)}}],a&&o(r.prototype,a),s&&o(r,s),Object.defineProperty(r,"prototype",{writable:!1}),e}();function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}a.Stats=window.Stats;var l=function(){function e(r,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),i||(i=n),this.camera=r,this.near=n,this.far=i,this.depth=Math.abs(i-n),this.x=new t.Vector3,this.y=new t.Vector3,this.z=new t.Vector3}var r,n,i;return r=e,(n=[{key:"update",value:function(){var t=this.getVisibleHeight(this.far),e=t*this.camera.aspect;this.height=t,this.width=e,this.left=.5*-e,this.right=.5*e,this.top=.5*t,this.bottom=.5*-t,this.x.set(this.left,this.right,this.width),this.y.set(this.bottom,this.top,this.height),this.z.set(this.far,this.near,this.depth),this.needsUpdate=!1}},{key:"getVisibleHeight",value:function(t){return e.getVisibleHeight(this.camera,t)}},{key:"getVisibleWidth",value:function(t){return e.getVisibleWidth(this.camera,t)}}])&&s(r.prototype,n),i&&s(r,i),Object.defineProperty(r,"prototype",{writable:!1}),e}();l.getVisibleHeight=function(t,e){var r=t.position.z;void 0===e&&(e=r),e+=e<r?-r:r;var n=t.fov*Math.PI/180;return 2*Math.tan(n/2)*Math.abs(e)},l.getVisibleWidth=function(t,e){return l.getVisibleHeight(t,e)*t.aspect};class u{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const c=new t.OrthographicCamera(-1,1,1,-1,0,1),f=new t.BufferGeometry;f.setAttribute("position",new t.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),f.setAttribute("uv",new t.Float32BufferAttribute([0,2,0,0,2,0],2));class h{constructor(e){this._mesh=new t.Mesh(f,e)}dispose(){this._mesh.geometry.dispose()}render(t){t.render(this._mesh,c)}get material(){return this._mesh.material}set material(t){this._mesh.material=t}}var d={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\t\t}"};const p={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new t.Color(0)},defaultOpacity:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec3 defaultColor;\n\t\tuniform float defaultOpacity;\n\t\tuniform float luminosityThreshold;\n\t\tuniform float smoothWidth;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\n\t\t\tvec3 luma = vec3( 0.299, 0.587, 0.114 );\n\n\t\t\tfloat v = dot( texel.xyz, luma );\n\n\t\t\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n\n\t\t\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n\n\t\t\tgl_FragColor = mix( outputColor, texel, alpha );\n\n\t\t}"};class v extends u{constructor(e,r,n,i){super(),this.strength=void 0!==r?r:1,this.radius=n,this.threshold=i,this.resolution=void 0!==e?new t.Vector2(e.x,e.y):new t.Vector2(256,256),this.clearColor=new t.Color(0,0,0);const o={minFilter:t.LinearFilter,magFilter:t.LinearFilter,format:t.RGBAFormat};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let a=Math.round(this.resolution.x/2),s=Math.round(this.resolution.y/2);this.renderTargetBright=new t.WebGLRenderTarget(a,s,o),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let e=0;e<this.nMips;e++){const r=new t.WebGLRenderTarget(a,s,o);r.texture.name="UnrealBloomPass.h"+e,r.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(r);const n=new t.WebGLRenderTarget(a,s,o);n.texture.name="UnrealBloomPass.v"+e,n.texture.generateMipmaps=!1,this.renderTargetsVertical.push(n),a=Math.round(a/2),s=Math.round(s/2)}void 0===p&&console.error("THREE.UnrealBloomPass relies on LuminosityHighPassShader");const l=p;this.highPassUniforms=t.UniformsUtils.clone(l.uniforms),this.highPassUniforms.luminosityThreshold.value=i,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new t.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,defines:{}}),this.separableBlurMaterials=[];const u=[3,5,7,9,11];a=Math.round(this.resolution.x/2),s=Math.round(this.resolution.y/2);for(let e=0;e<this.nMips;e++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(u[e])),this.separableBlurMaterials[e].uniforms.texSize.value=new t.Vector2(a,s),a=Math.round(a/2),s=Math.round(s/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=r,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new t.Vector3(1,1,1),new t.Vector3(1,1,1),new t.Vector3(1,1,1),new t.Vector3(1,1,1),new t.Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===d&&console.error("THREE.UnrealBloomPass relies on CopyShader");const c=d;this.copyUniforms=t.UniformsUtils.clone(c.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new t.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,blending:t.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new t.Color,this.oldClearAlpha=1,this.basic=new t.MeshBasicMaterial,this.fsQuad=new h(null)}dispose(){for(let t=0;t<this.renderTargetsHorizontal.length;t++)this.renderTargetsHorizontal[t].dispose();for(let t=0;t<this.renderTargetsVertical.length;t++)this.renderTargetsVertical[t].dispose();this.renderTargetBright.dispose()}setSize(e,r){let n=Math.round(e/2),i=Math.round(r/2);this.renderTargetBright.setSize(n,i);for(let e=0;e<this.nMips;e++)this.renderTargetsHorizontal[e].setSize(n,i),this.renderTargetsVertical[e].setSize(n,i),this.separableBlurMaterials[e].uniforms.texSize.value=new t.Vector2(n,i),n=Math.round(n/2),i=Math.round(i/2)}render(t,e,r,n,i){t.getClearColor(this._oldClearColor),this.oldClearAlpha=t.getClearAlpha();const o=t.autoClear;t.autoClear=!1,t.setClearColor(this.clearColor,0),i&&t.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=r.texture,t.setRenderTarget(null),t.clear(),this.fsQuad.render(t)),this.highPassUniforms.tDiffuse.value=r.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,t.setRenderTarget(this.renderTargetBright),t.clear(),this.fsQuad.render(t);let a=this.renderTargetBright;for(let e=0;e<this.nMips;e++)this.fsQuad.material=this.separableBlurMaterials[e],this.separableBlurMaterials[e].uniforms.colorTexture.value=a.texture,this.separableBlurMaterials[e].uniforms.direction.value=v.BlurDirectionX,t.setRenderTarget(this.renderTargetsHorizontal[e]),t.clear(),this.fsQuad.render(t),this.separableBlurMaterials[e].uniforms.colorTexture.value=this.renderTargetsHorizontal[e].texture,this.separableBlurMaterials[e].uniforms.direction.value=v.BlurDirectionY,t.setRenderTarget(this.renderTargetsVertical[e]),t.clear(),this.fsQuad.render(t),a=this.renderTargetsVertical[e];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,t.setRenderTarget(this.renderTargetsHorizontal[0]),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,i&&t.state.buffers.stencil.setTest(!0),this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(r),this.fsQuad.render(t)),t.setClearColor(this._oldClearColor,this.oldClearAlpha),t.autoClear=o}getSeperableBlurMaterial(e){return new t.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new t.Vector2(.5,.5)},direction:{value:new t.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\n\t\t\t\tuniform vec2 direction;\n\n\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\n\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\n\t\t\t\t}\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\n\t\t\t\t\tfloat fSigma = float(SIGMA);\n\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\n\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\n\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat x = float(i);\n\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\n\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\n\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\n\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\n\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\n\t\t\t\t\t\tweightSum += 2.0 * w;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})}getCompositeMaterial(e){return new t.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform sampler2D dirtTexture;\n\t\t\t\tuniform float bloomStrength;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\n\t\t\t\tfloat lerpBloomFactor(const in float factor) {\n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n\t\t\t\t}"})}}v.BlurDirectionX=new t.Vector2(1,0),v.BlurDirectionY=new t.Vector2(0,1);const m="vec3 bayerMatrixDither( vec3 color ) {\r\n\r\n\t// Silly code because old devices ( OpenGL ES < 3 ) don't support arrays\r\n\r\n\tint index = int( mod( gl_FragCoord.x - 0.5, 8.0 ) ) + \r\n\t\tint( mod( gl_FragCoord.y - 0.5, 8.0 ) * 8.0 );\r\n\r\n\tfloat dither = 0.0078;\r\n\r\n\tdither = ( index == 1 ) ? 0.0039 : dither;\r\n\tdither = ( index == 2 ) ? 0.0068 : dither;\r\n\tdither = ( index == 3 ) ? 0.0029 : dither;\r\n\tdither = ( index == 4 ) ? 0.0076 : dither;\r\n\tdither = ( index == 5 ) ? 0.0036 : dither;\r\n\tdither = ( index == 6 ) ? 0.0066 : dither;\r\n\tdither = ( index == 7 ) ? 0.0027 : dither;\r\n\r\n\tdither = ( index == 8 )  ? 0.0019 : dither;\r\n\tdither = ( index == 9 )  ? 0.0059 : dither;\r\n\tdither = ( index == 10 ) ? 0.0009 : dither;\r\n\tdither = ( index == 11 ) ? 0.0049 : dither;\r\n\tdither = ( index == 12 ) ? 0.0017 : dither;\r\n\tdither = ( index == 13 ) ? 0.0056 : dither;\r\n\tdither = ( index == 14 ) ? 0.0007 : dither;\r\n\tdither = ( index == 15 ) ? 0.0046 : dither;\r\n\r\n\tdither = ( index == 16 ) ? 0.0063 : dither;\r\n\tdither = ( index == 17 ) ? 0.0024 : dither;\r\n\tdither = ( index == 18 ) ? 0.0073 : dither;\r\n\tdither = ( index == 19 ) ? 0.0034 : dither;\r\n\tdither = ( index == 20 ) ? 0.0061 : dither;\r\n\tdither = ( index == 21 ) ? 0.0022 : dither;\r\n\tdither = ( index == 22 ) ? 0.0071 : dither;\r\n\tdither = ( index == 23 ) ? 0.0032 : dither;\r\n\r\n\tdither = ( index == 24 ) ? 0.0005 : dither;\r\n\tdither = ( index == 25 ) ? 0.0044 : dither;\r\n\tdither = ( index == 26 ) ? 0.0014 : dither;\r\n\tdither = ( index == 27 ) ? 0.0054 : dither;\r\n\tdither = ( index == 28 ) ? 0.0002 : dither;\r\n\tdither = ( index == 29 ) ? 0.0041 : dither;\r\n\tdither = ( index == 30 ) ? 0.0012 : dither;\r\n\tdither = ( index == 31 ) ? 0.0051 : dither;\r\n\r\n\tdither = ( index == 32 ) ? 0.0074 : dither;\r\n\tdither = ( index == 33 ) ? 0.0035 : dither;\r\n\tdither = ( index == 34 ) ? 0.0065 : dither;\r\n\tdither = ( index == 35 ) ? 0.0025 : dither;\r\n\tdither = ( index == 36 ) ? 0.0077 : dither;\r\n\tdither = ( index == 37 ) ? 0.0038 : dither;\r\n\tdither = ( index == 38 ) ? 0.0067 : dither;\r\n\tdither = ( index == 39 ) ? 0.0028 : dither;\r\n\r\n\tdither = ( index == 40 ) ? 0.0016 : dither;\r\n\tdither = ( index == 41 ) ? 0.0055 : dither;\r\n\tdither = ( index == 42 ) ? 0.0006 : dither;\r\n\tdither = ( index == 43 ) ? 0.0045 : dither;\r\n\tdither = ( index == 44 ) ? 0.0018 : dither;\r\n\tdither = ( index == 45 ) ? 0.0057 : dither;\r\n\tdither = ( index == 46 ) ? 0.0008 : dither;\r\n\tdither = ( index == 47 ) ? 0.0047 : dither;\r\n\r\n\tdither = ( index == 48 ) ? 0.006  : dither;\r\n\tdither = ( index == 49 ) ? 0.0021 : dither;\r\n\tdither = ( index == 50 ) ? 0.007  : dither;\r\n\tdither = ( index == 51 ) ? 0.003  : dither;\r\n\tdither = ( index == 52 ) ? 0.0062 : dither;\r\n\tdither = ( index == 53 ) ? 0.0023 : dither;\r\n\tdither = ( index == 54 ) ? 0.0072 : dither;\r\n\tdither = ( index == 55 ) ? 0.0033 : dither;\r\n\r\n\tdither = ( index == 56 ) ? 0.0001 : dither;\r\n\tdither = ( index == 57 ) ? 0.004  : dither;\r\n\tdither = ( index == 58 ) ? 0.0011 : dither;\r\n\tdither = ( index == 59 ) ? 0.005  : dither;\r\n\tdither = ( index == 60 ) ? 0.0003 : dither;\r\n\tdither = ( index == 61 ) ? 0.0043 : dither;\r\n\tdither = ( index == 62 ) ? 0.0013 : dither;\r\n\tdither = ( index == 63 ) ? 0.0052 : dither;\r\n\r\n\treturn color - dither;\r\n\t\r\n}";function y(t){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(t)}function b(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function g(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function x(t,e){return x=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},x(t,e)}function w(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=S(t);if(e){var i=S(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return P(this,r)}}function P(t,e){if(e&&("object"===y(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function S(t){return S=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},S(t)}var T=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&x(t,e)}(a,e);var r,n,i,o=w(a);function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.strength,n=void 0===r?.6:r,i=e.radius,s=void 0===i?1:i,l=e.threshold,u=void 0===l?.3:l;return b(this,a),o.call(this,new t.Vector2,n,s,u)}return r=a,(n=[{key:"getCompositeMaterial",value:function(e){return new t.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform sampler2D dirtTexture;\n\t\t\t\tuniform float bloomStrength;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\n\t\t\t\tfloat lerpBloomFactor(const in float factor) {\n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\n\t\t\t\t".concat(m,"\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec4 color = bloomStrength * ( \n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv)\n\t\t\t\t\t);\n\n\t\t\t\t\tcolor.rgb = bayerMatrixDither( color.rgb );\n\n\t\t\t\t\tgl_FragColor = color;\n\t\t\t\t}\n\t\t\t")})}}])&&g(r.prototype,n),i&&g(r,i),Object.defineProperty(r,"prototype",{writable:!1}),a}(v);class k{constructor(t=Math){this.prng=t}random(){return this.prng.random()}amount(){return this.random()}number(t=0,e=1,r=!1){const n=this.random();return isNaN(t)||isNaN(e)?n:r?Math.floor(n*(e-t+1)+t):n*(e-t)+t}noise(){return this.number(-1,1)}int(t,e){return this.number(t,e,!0)}uint(t){return this.int(0,t)}boolean(){return this.random()<.5}chance(t){return this.random()<t}item(t){return t[this.uint(t.length-1)]}char(t){return t.charAt(this.uint(t.length-1))}}const O="vec3 linearGradient( \r\n\tvec2 origin,\r\n\tvec2 target,\r\n\tvec3 color1,\r\n\tvec3 color2,\r\n\tfloat angle\r\n) {\r\n\r\n\tfloat toTarget = length( target );\r\n\tangle = radians( angle ) + atan( target.y, target.x );\r\n\r\n\tfloat progressX = cos( angle ) * toTarget;\r\n\tfloat progressY = sin( angle ) * toTarget;\r\n\tvec2 progress = vec2( progressX, progressY ) + origin;\r\n\r\n\treturn mix( color1, color2, smoothstep( 0.0, 1.0, progress.x ) );\r\n\t\r\n}";function C(t){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C(t)}function _(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function D(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?_(Object(r),!0).forEach((function(e){z(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function z(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function j(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function R(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function M(t,e){return M=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},M(t,e)}function U(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=G(t);if(e){var i=G(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return E(this,r)}}function E(t,e){if(e&&("object"===C(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function G(t){return G=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},G(t)}var B=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&M(t,e)}(a,e);var r,n,i,o=U(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.color1,i=void 0===n?16777215:n,s=r.color2,l=void 0===s?0:s,u=r.angle,c=void 0===u?90:u;j(this,a);var f=new t.PlaneGeometry(2,2),h=new t.ShaderMaterial(D(D({},a.shader),{},{uniforms:{uAngle:{value:c},uColor1:{value:new t.Color(i)},uColor2:{value:new t.Color(l)}}}));return(e=o.call(this,f,h)).frustumCulled=!1,e}return r=a,(n=[{key:"angle",get:function(){return this.material.uniforms.uAngle.value},set:function(t){this.material.uniforms.uAngle.value=t}},{key:"color1",get:function(){return this.material.uniforms.uColor1.value},set:function(t){this.material.uniforms.uColor1.value=t}},{key:"color2",get:function(){return this.material.uniforms.uColor2.value},set:function(t){this.material.uniforms.uColor2.value=t}}])&&R(r.prototype,n),i&&R(r,i),Object.defineProperty(r,"prototype",{writable:!1}),a}(t.Mesh);B.shader={depthWrite:!1,depthTest:!1,vertexShader:"varying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n\tvUv = uv;\r\n\r\n\tgl_Position = vec4( position, 1.0 );\r\n\r\n}",fragmentShader:"\n\t\tuniform float uAngle;\n\t\tuniform vec3 uColor1;\n\t\tuniform vec3 uColor2;\n\t\tvarying vec2 vUv;\n\t\t\n\t\t".concat(O,"\n\t\t").concat(m,"\n\n\t\tvoid main() {\n\n\t\t\tvec2 origin = vec2( 0.5, 0.5 );\n\t\t\tvec2 target = vUv - origin;\n\t\t\tvec3 color = linearGradient( origin, target, uColor1, uColor2, uAngle );\n\t\t\t\n\t\t\tcolor = bayerMatrixDither( color );\n\n\t\t\tgl_FragColor = vec4( color, 1.0 );\n\t\t\t\n\t\t}")};class F extends u{constructor(e,r){super(),this.textureID=void 0!==r?r:"tDiffuse",e instanceof t.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=t.UniformsUtils.clone(e.uniforms),this.material=new t.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new h(this.material)}render(t,e,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(e),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}}class A extends u{constructor(t,e){super(),this.scene=t,this.camera=e,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(t,e,r){const n=t.getContext(),i=t.state;let o,a;i.buffers.color.setMask(!1),i.buffers.depth.setMask(!1),i.buffers.color.setLocked(!0),i.buffers.depth.setLocked(!0),this.inverse?(o=0,a=1):(o=1,a=0),i.buffers.stencil.setTest(!0),i.buffers.stencil.setOp(n.REPLACE,n.REPLACE,n.REPLACE),i.buffers.stencil.setFunc(n.ALWAYS,o,4294967295),i.buffers.stencil.setClear(a),i.buffers.stencil.setLocked(!0),t.setRenderTarget(r),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(e),this.clear&&t.clear(),t.render(this.scene,this.camera),i.buffers.color.setLocked(!1),i.buffers.depth.setLocked(!1),i.buffers.stencil.setLocked(!1),i.buffers.stencil.setFunc(n.EQUAL,1,4294967295),i.buffers.stencil.setOp(n.KEEP,n.KEEP,n.KEEP),i.buffers.stencil.setLocked(!0)}}class X extends u{constructor(){super(),this.needsSwap=!1}render(t){t.state.buffers.stencil.setLocked(!1),t.state.buffers.stencil.setTest(!1)}}class Y{constructor(e,r){if(this.renderer=e,void 0===r){const n={minFilter:t.LinearFilter,magFilter:t.LinearFilter,format:t.RGBAFormat},i=e.getSize(new t.Vector2);this._pixelRatio=e.getPixelRatio(),this._width=i.width,this._height=i.height,(r=new t.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,n)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=r.width,this._height=r.height;this.renderTarget1=r,this.renderTarget2=r.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===d&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===F&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new F(d),this.clock=new t.Clock}swapBuffers(){const t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t}addPass(t){this.passes.push(t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(t,e){this.passes.splice(e,0,t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(t){const e=this.passes.indexOf(t);-1!==e&&this.passes.splice(e,1)}isLastEnabledPass(t){for(let e=t+1;e<this.passes.length;e++)if(this.passes[e].enabled)return!1;return!0}render(t){void 0===t&&(t=this.clock.getDelta());const e=this.renderer.getRenderTarget();let r=!1;for(let e=0,n=this.passes.length;e<n;e++){const n=this.passes[e];if(!1!==n.enabled){if(n.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(e),n.render(this.renderer,this.writeBuffer,this.readBuffer,t,r),n.needsSwap){if(r){const e=this.renderer.getContext(),r=this.renderer.state.buffers.stencil;r.setFunc(e.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),r.setFunc(e.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==A&&(n instanceof A?r=!0:n instanceof X&&(r=!1))}}this.renderer.setRenderTarget(e)}reset(e){if(void 0===e){const r=this.renderer.getSize(new t.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=r.width,this._height=r.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(t,e){this._width=t,this._height=e;const r=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget1.setSize(r,n),this.renderTarget2.setSize(r,n);for(let t=0;t<this.passes.length;t++)this.passes[t].setSize(r,n)}setPixelRatio(t){this._pixelRatio=t,this.setSize(this._width,this._height)}}new t.OrthographicCamera(-1,1,1,-1,0,1);const V=new t.BufferGeometry;V.setAttribute("position",new t.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),V.setAttribute("uv",new t.Float32BufferAttribute([0,2,0,0,2,0],2));class I extends u{constructor(e,r,n,i,o){super(),this.scene=e,this.camera=r,this.overrideMaterial=n,this.clearColor=i,this.clearAlpha=void 0!==o?o:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new t.Color}render(t,e,r){const n=t.autoClear;let i,o;t.autoClear=!1,void 0!==this.overrideMaterial&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(t.getClearColor(this._oldClearColor),i=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&t.clearDepth(),t.setRenderTarget(this.renderToScreen?null:r),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),t.render(this.scene,this.camera),this.clearColor&&t.setClearColor(this._oldClearColor,i),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=o),t.autoClear=n}}function L(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function N(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Z=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.renderer,i=r.stage,o=r.useRenderTarget,a=void 0!==o&&o;L(this,e),a&&(this.renderTarget=new t.WebGLRenderTarget),this.composer=new Y(n,this.renderTarget),this.composer.renderToScreen=!a,this.passes={},this.add("render",new I(i.scene,i.camera))}var r,n,i;return r=e,(n=[{key:"add",value:function(t,e){this.passes[t]=e,this.composer.addPass(e)}},{key:"remove",value:function(t){var e,r=this.passes[t];r&&(this.composer.removePass(r),null==r||null===(e=r.dispose)||void 0===e||e.call(r),delete this.passes[t])}},{key:"resize",value:function(t,e,r){this.composer.setSize(t,e),Object.values(this.passes).forEach((function(n){return null==n?void 0:n.setSize(t,e,r)}))}},{key:"tick",value:function(){this.composer.render()}},{key:"dispose",value:function(){Object.values(this.passes).forEach((function(t){var e;return null==t||null===(e=t.dispose)||void 0===e?void 0:e.call(t)})),Object.values(this).forEach((function(t){var e;return null==t||null===(e=t.dispose)||void 0===e?void 0:e.call(t)}))}}])&&N(r.prototype,n),i&&N(r,i),Object.defineProperty(r,"prototype",{writable:!1}),e}();function W(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function H(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Q=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.target,n=void 0===r?window:r,i=e.width,o=void 0===i?window.innerWidth:i,a=e.height,s=void 0===a?window.innerHeight:a,l=e.margin,u=void 0===l?0:l,c=e.marginTop,f=e.marginRight,h=e.marginBottom,d=e.marginLeft,p=e.enabled,v=void 0===p||p,m=e.debug,y=void 0!==m&&m,b=e.onChange;W(this,t);var g=function(t){return"number"==typeof t&&t>=0?t:u};this.margin={top:g(c),right:g(f),bottom:g(h),left:g(d)},this.hitbox={top:this.margin.top,left:this.margin.left,width:o,height:s},this.resize(o,s),this.x=this.y=.5,this.target=n,this.onMouseMove=function(t){t.preventDefault&&t.preventDefault(),this.track(t.clientX,t.clientY)}.bind(this),this.onTouchMove=function(t){t.preventDefault(),this.onMouseMove(t.targetTouches[0])}.bind(this),this.onChange=b,y&&(this.onDebug=this.log),v&&this.enable()}var e,r,n;return e=t,(r=[{key:"enable",value:function(){this._enabled||(this.target.addEventListener("touchmove",this.onTouchMove),this.target.addEventListener("mousemove",this.onMouseMove),this._enabled=!0)}},{key:"disable",value:function(){this._enabled&&(this.target.removeEventListener("touchmove",this.onTouchMove),this.target.removeEventListener("mousemove",this.onMouseMove),this._enabled=!1)}},{key:"dispose",value:function(){this.disable()}},{key:"track",value:function(t,e){var r,n,i;if(this.clientX!==t){this.clientX=t;var o=this.normalizeX;this.x!==o&&(this.x=o,i=!0)}if(this.clientY!==e){this.clientY=e;var a=this.normalizeY;this.y!==a&&(this.y=a,i=!0)}i&&(null===(r=this.onChange)||void 0===r||r.call(this),null===(n=this.onDebug)||void 0===n||n.call(this))}},{key:"resize",value:function(t,e){var r=this.margin.left*t,n=this.margin.right*t;this.hitbox.width=t-r-n,this.offsetX=r;var i=this.margin.top*e,o=this.margin.bottom*e;this.hitbox.height=e-i-o,this.offsetY=i}},{key:"log",value:function(){var t=this.x,e=this.y,r=this.reverseX,n=this.reverseY,i=this.polarizeX,o=this.polarizeY,a=this.reversePolarizeX,s=this.reversePolarizeY,l=this.centerX,u=this.centerY,c=this.reverseCenterX,f=this.reverseCenterY;console.log({x:t,y:e,reverseX:r,reverseY:n,polarizeX:i,polarizeY:o,reversePolarizeX:a,reversePolarizeY:s,centerX:l,centerY:u,reverseCenterX:c,reverseCenterY:f})}},{key:"normalizeX",get:function(){return t.normalize(this.clientX-this.offsetX,this.hitbox.width)}},{key:"normalizeY",get:function(){return t.normalize(this.clientY-this.offsetY,this.hitbox.height)}},{key:"reverseX",get:function(){return t.reverse(this.x)}},{key:"reverseY",get:function(){return t.reverse(this.y)}},{key:"polarizeX",get:function(){return t.polarize(this.x)}},{key:"polarizeY",get:function(){return t.polarize(this.y)}},{key:"reversePolarizeX",get:function(){return t.reversePolarize(this.x)}},{key:"reversePolarizeY",get:function(){return t.reversePolarize(this.y)}},{key:"centerX",get:function(){return t.center(this.x)}},{key:"centerY",get:function(){return t.center(this.y)}},{key:"reverseCenterX",get:function(){return t.reverseCenter(this.x)}},{key:"reverseCenterY",get:function(){return t.reverseCenter(this.y)}}])&&H(e.prototype,r),n&&H(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function q(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function K(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}Q.clamp=function(t){return t>1?1:t<0?0:t},Q.normalize=function(t,e){return Q.clamp(t/e)},Q.reverse=function(t){return 1-t},Q.polarize=function(t){return 2*t-1},Q.reversePolarize=function(t){return 1-2*t},Q.center=function(t){return 1-2*Math.abs(t-.5)},Q.reverseCenter=function(t){return 2*Math.abs(t-.5)};var J=function(){function e(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.lookAt,o=void 0===i?{x:0,y:0,z:0}:i,a=n.bounds,s=void 0===a?{x:5,y:5,z:0}:a,l=n.speed,u=void 0===l?.002:l,c=n.intro;q(this,e),this.camera=r,this.lookAt=new t.Vector3(o.x,o.y,o.z),this.bounds=new t.Vector3(s.x,s.y,s.z),this.speed=u,this.origin=(new t.Vector3).copy(r.position),this.target=new t.Vector3,c&&this.set(c.x,c.y,c.z)}var r,n,i;return r=e,n=[{key:"set",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.camera.position.set(t,e,r),this}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.target.x=this.origin.x+this.bounds.x*t,this.target.y=this.origin.y+this.bounds.y*e,this.target.z=this.origin.z+this.bounds.z*r,this}},{key:"tick",value:function(e){var r=t.MathUtils.clamp(this.speed*e,0,1);return this.camera.position.lerp(this.target,r),this.camera.lookAt(this.lookAt),this}}],n&&K(r.prototype,n),i&&K(r,i),Object.defineProperty(r,"prototype",{writable:!1}),e}();function $(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var et=function(){function e(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.plane,o=n.width,a=void 0===o?1e3:o,s=n.height,l=void 0===s?1e3:s,u=n.horizontal,c=void 0!==u&&u,f=n.cursor,h=n.cursorSize,d=void 0===h?.1:h,p=n.color,v=void 0===p?16711680:p,m=n.opacity,y=void 0===m?.15:m,b=n.lerp,g=n.autoRotate;$(this,e),i||(i=new t.Mesh(new t.PlaneGeometry(a,l),new t.MeshBasicMaterial({color:v,opacity:y,transparent:y<1})),c&&i.rotateX(-Math.PI/2)),f||(f=new t.Mesh(new t.BoxGeometry(d,d,d),new t.MeshBasicMaterial({color:v}))),r.add(i),r.add(f),this.plane=i,this.cursor=f,this.lerp=b,this.autoRotate=g,this.camera=r.camera,this.tracker=new t.Vector2,this.raycaster=new t.Raycaster,r.debug||(this.plane.visible=!1,this.cursor.visible=!1)}var r,n,i;return r=e,(n=[{key:"set",value:function(t,e){this.tracker.set(t,e)}},{key:"tick",value:function(e){this.autoRotate&&this.plane.quaternion.copy(this.camera.quaternion),this.raycaster.setFromCamera(this.tracker,this.camera);var r=this.raycaster.intersectObject(this.plane)[0];if(null!=r&&r.point){if(!this.lerp)return this.cursor.position.copy(r.point);var n=t.MathUtils.clamp(this.lerp*e,0,1);this.cursor.position.lerp(r.point,n)}}}])&&tt(r.prototype,n),i&&tt(r,i),Object.defineProperty(r,"prototype",{writable:!1}),e}();function rt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var nt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.sketch=e,!1!==e.settings.cursorTracker&&this.initTracker(),e.settings.cursorProjector&&this.initProjector(),e.settings.cameraRig&&this.initCameraRig(),e.settings.gui&&this.initGUI()}var e,r,n;return e=t,(r=[{key:"initTracker",value:function(){this.tracker=new Q,this.trackerEnabled=!0}},{key:"initProjector",value:function(){this.projector=new et(this.sketch,this.sketch.settings.cursorProjector),this.cursor=this.projector.cursor}},{key:"initCameraRig",value:function(){var t=this.sketch.settings,e=t.camera.lookAt,r=t.cameraRig.bounds,n=t.cameraRig.speed,i=t.cameraRig.intro;this.cameraRig=new J(this.sketch.camera,{lookAt:e,bounds:r,speed:n,intro:i}),this.cameraRigEnabled=!0}},{key:"initGUI",value:function(){this.gui=new t.GUI,this.gui.title(this.sketch.name.toUpperCase()),this.autoCloseGUI()}},{key:"autoCloseGUI",value:function(){this.gui&&(this.sketch.sketchpad.wide||this.gui.close())}},{key:"refreshGUI",value:function(){this.gui&&!this.gui._closed&&this.gui.controllersRecursive().forEach((function(t){return t.updateDisplay()}))}},{key:"resize",value:function(t,e){var r;null===(r=this.tracker)||void 0===r||r.resize(t,e),this.autoCloseGUI()}},{key:"tick",value:function(t){this.cameraRigEnabled&&this.cameraRig.update(this.tracker.reversePolarizeX,this.tracker.y).tick(t)}}])&&rt(e.prototype,r),n&&rt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function it(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ot(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}nt.GUI=window.GUI,nt.VALUE="value",nt.clamp=t.MathUtils.clamp,nt.lerp=t.MathUtils.lerp;var at=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.background,i=r.camera;if(it(this,e),this.scene=new t.Scene,n&&(this.scene.background=n),i){if(i instanceof t.Camera==!1){var o=i.start,a=i.lookAt;i=new t.PerspectiveCamera(i.fov,i.aspect,i.near,i.far),o&&i.position.set(o.x,o.y,o.z),a&&i.lookAt(a.x,a.y,a.z)}}else i=new t.PerspectiveCamera;this.camera=i}var r,n,i;return r=e,(n=[{key:"add",value:function(t){this.scene.add(t)}},{key:"remove",value:function(t){this.scene.remove(t)}},{key:"resize",value:function(t,e){this.camera.aspect=t/e,this.camera.updateProjectionMatrix()}}])&&ot(r.prototype,n),i&&ot(r,i),Object.defineProperty(r,"prototype",{writable:!1}),e}();function st(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function lt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?st(Object(r),!0).forEach((function(e){ut(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):st(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function ut(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ct(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ft(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var ht=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.defaults,n=void 0===r?{}:r,i=t.settings,o=void 0===i?{}:i,s=t.stage,l=t.background,u=t.random;ct(this,e),o=lt(lt({},n),o),this.settings=o,s||(s=new at(o)),this.stage=s;var c=o.sketchpad||new a;this.sketchpad=c,this.effects=new Z({renderer:c.renderer,stage:s}),this.random=u||o.random?new k:null,!l&&o.background&&this.initBackground()}var r,n,i;return r=e,n=[{key:"initBackground",value:function(){var e=this.settings.background,r=e instanceof t.Color?e:("string"==typeof e||"number"==typeof e)&&new t.Color(e);if(r)return this.stage.background=r;e.color1&&e.color2&&(this.background=new B(e),this.add(this.background))}},{key:"init",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:nt;this.initScene(),t&&(this.controls=new t(this))}},{key:"initScene",value:function(){}},{key:"dispose",value:function(){this.stage.dispose(),this.effects.dispose()}},{key:"resize",value:function(t,e,r){var n,i;this.stage.resize(t,e),null===(n=this.controls)||void 0===n||n.resize(t,e),null===(i=this.effects)||void 0===i||i.resize(t,e,r)}},{key:"tick",value:function(t,e){var r;null===(r=this.controls)||void 0===r||r.tick(t,e),this.effects.tick(t,e)}},{key:"add",value:function(t){this.stage.add(t)}},{key:"remove",value:function(t){this.stage.remove(t)}},{key:"camera",get:function(){return this.stage.camera}},{key:"debug",get:function(){return this.sketchpad.debug}},{key:"name",get:function(){return this.settings.name||"Sketch"}}],n&&ft(r.prototype,n),i&&ft(r,i),Object.defineProperty(r,"prototype",{writable:!1}),e}();Math.PI;const dt="float loopValue( float value, float minimum, float change ) {\r\n\r\n\treturn minimum + mod( value - minimum, change );\r\n\r\n}",pt="//\tSimplex 3D Noise \n//\tby Ian McEwan, Ashima Arts\n//\nvec4 permute( vec4 x ){ return mod( ( ( x * 34.0 ) + 1.0 ) * x, 289.0 ); }\nvec4 taylorInvSqrt( vec4 r ){ return 1.79284291400159 - 0.85373472095314 * r; }\n\nfloat simplex3D( float vx, float vy, float vz ) {\n\n\tvec3 v = vec3( vx, vy, vz );\n\t\n\tconst vec2 C = vec2( 1.0/6.0, 1.0/3.0   );\n\tconst vec4 D = vec4( 0.0, 0.5, 1.0, 2.0 );\n\n\t// First corner\n\tvec3 i  = floor( v + dot( v, C.yyy ) );\n\tvec3 x0 =   v - i + dot( i, C.xxx ) ;\n\n\t// Other corners\n\tvec3 g = step( x0.yzx, x0.xyz );\n\tvec3 l = 1.0 - g;\n\tvec3 i1 = min(  g.xyz, l.zxy );\n\tvec3 i2 = max(  g.xyz, l.zxy );\n\n\t// x0 = x0 - 0. + 0.0 * C \n\tvec3 x1 = x0 - i1 + 1.0 * C.xxx;\n\tvec3 x2 = x0 - i2 + 2.0 * C.xxx;\n\tvec3 x3 = x0 - 1. + 3.0 * C.xxx;\n\n\t// Permutations\n\ti = mod( i, 289.0 ); \n\tvec4 p = permute( permute( permute(\n\t\t\t i.z + vec4( 0.0, i1.z, i2.z, 1.0 ) )\n\t\t   + i.y + vec4( 0.0, i1.y, i2.y, 1.0 ) ) \n\t\t   + i.x + vec4( 0.0, i1.x, i2.x, 1.0 ) );\n\n\t// Gradients\n\t// ( N*N points uniformly over a square, mapped onto an octahedron.)\n  \tfloat n_ = 1.0/7.0; // N=7\n  \tvec3  ns = n_ * D.wyz - D.xzx;\n\n  \tvec4 j = p - 49.0 * floor( p * ns.z *ns.z ); //  mod( p,N*N)\n\n  \tvec4 x_ = floor( j * ns.z );\n  \tvec4 y_ = floor( j - 7.0 * x_ ); // mod( j,N)\n\n  \tvec4 x = x_ *ns.x + ns.yyyy;\n  \tvec4 y = y_ *ns.x + ns.yyyy;\n  \tvec4 h = 1.0 - abs( x ) - abs( y );\n\n  \tvec4 b0 = vec4( x.xy, y.xy );\n  \tvec4 b1 = vec4( x.zw, y.zw );\n\n  \tvec4 s0 = floor( b0 )*2.0 + 1.0;\n  \tvec4 s1 = floor( b1 )*2.0 + 1.0;\n  \tvec4 sh = -step( h, vec4( 0.0 ) );\n\n  \tvec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  \tvec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  \tvec3 p0 = vec3( a0.xy,h.x );\n  \tvec3 p1 = vec3( a0.zw,h.y );\n  \tvec3 p2 = vec3( a1.xy,h.z );\n  \tvec3 p3 = vec3( a1.zw,h.w );\n\n\t// Normalise gradients\n  \tvec4 norm = taylorInvSqrt( \n\t\tvec4( dot( p0, p0 ), dot( p1, p1 ), dot( p2, p2 ), dot( p3, p3 ) )\n\t);\n  \tp0 *= norm.x;\n  \tp1 *= norm.y;\n  \tp2 *= norm.z;\n  \tp3 *= norm.w;\n\n\t// Mix final noise value\n  \tvec4 m = max( \n\t\t0.6 - vec4( dot( x0, x0 ), dot( x1, x1 ), dot( x2, x2 ), dot( x3, x3 ) ), \n\t\t0.0\n\t);\n  \tm = m * m;\n  \treturn 42.0 * dot( \n\t\tm*m,\n\t\tvec4( dot( p0,x0 ), dot( p1,x1 ), dot( p2,x2 ), dot( p3,x3 ) )\n\t);\n\n}";var vt={glsl:"\nvec4 packFloat( float value ) {\n\n\tif ( value == 0.0 ) return vec4( 0.0, 0.0, 0.0, 0.0 );\n\n\tfloat mag = abs( value );\n\t\n\tfloat exponent = floor( log2( mag ) );\n\texponent += float( exp2( exponent ) <= mag / 2.0 );\n\texponent -= float( exp2( exponent ) > mag );\n\n\tfloat mantissa = ( exponent > 100.0 )\n\t\t? mag / 1024.0 / exp2( exponent - 10.0 ) - 1.0\n\t\t: mag / float( exp2( exponent ) ) - 1.0;\n\n\tfloat r = exponent + 127.0;\n\tmantissa *= 256.0;\n\n\tfloat g = floor( mantissa );\n\tmantissa -= g;\n\tmantissa *= 256.0;\n\n\tfloat b = floor( mantissa );\n\tmantissa -= b;\n\tmantissa *= 128.0;\n\n\tfloat a = floor( mantissa ) * 2.0 + float( value < 0.0 );\n\n\treturn vec4( r, g, b, a ) / 255.0;\n\n}\n\nfloat unpackFloat( vec4 value ) {\n\n\tfloat r = floor( value.r * 255.0 + 0.5 );\n\tfloat g = floor( value.g * 255.0 + 0.5 );\n\tfloat b = floor( value.b * 255.0 + 0.5 );\n\tfloat a = floor( value.a * 255.0 + 0.5 );\n\n\tfloat exponent = r - 127.0;\n\tfloat sign = 1.0 - mod( a, 2.0 ) * 2.0;\n\tfloat mantissa = float( r > 0.0 ) + g / 256.0 + b / 65536.0\n\t\t+ floor( a / 2.0 ) / 8388608.0;\n\treturn sign * mantissa * exp2( exponent );\n\n}",pack:function(t,e){var r,n,i,o,a,s,l;e||(e=new Uint8Array(4*t.length));for(var u=0,c=0,f=t.length;u<f;u++)0!==(r=t[u])&&(n=Math.abs(r),i=Math.floor(Math.log2(n)),i+=(o=Math.pow(2,i))<=n/2,a=(i-=o>n)>100?n/1024/Math.pow(2,i-10)-1:n/o-1,e[c]=i+127,a*=256,s=Math.floor(a),e[c+1]=s,a=256*(a-s),l=Math.floor(a),e[c+2]=l,a=128*(a-l),e[c+3]=2*Math.floor(a)+(r<0)),c+=4;return e},unpack:function(t,e){var r,n,i,o,a,s;e||(e=new Float32Array(t.length/4));for(var l=0,u=0,c=t.length;l<c;l+=4)r=t[l],n=t[l+1],i=t[l+2],a=r-127,s=(1-(o=t[l+3])%2*2)*((r>0)+n/256+i/65536+Math.floor(o/2)/8388608)*Math.pow(2,a),e[u]=s,u++}};function mt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function yt(t,e,r){return e&&mt(t.prototype,e),r&&mt(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}var bt="\n",gt=yt((function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}));function xt(t){return xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xt(t)}function wt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Pt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function St(t,e){return St=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},St(t,e)}function Tt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Ot(t);if(e){var i=Ot(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return kt(this,r)}}function kt(t,e){if(e&&("object"===xt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ot(t){return Ot=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ot(t)}gt.rotateX="mat3 rotateX( float angle ) {\r\n\treturn mat3(\r\n\t\tvec3(   1.0,\t        0.0,             0.0\t    ),\r\n\t\tvec3(   0.0, \t        cos(angle), \t-sin(angle) ),\r\n\t\tvec3(   0.0, \t        sin(angle), \t cos(angle) )\r\n\t);\r\n}",gt.rotateY="mat3 rotateY( float angle ) {\r\n\treturn mat3(\r\n\t\tvec3(   cos(angle),    0.0,           sin(angle)  ),\r\n\t\tvec3(   0.0,           1.0,           0.0         ),\r\n\t\tvec3(   -sin(angle),   0.0,           cos(angle)  )\r\n\t);\r\n}",gt.rotateZ="mat3 rotateZ( float angle ) {\r\n\treturn mat3(\r\n\t\tvec3(   cos(angle),   -sin(angle),     0.0   ),\r\n\t\tvec3(   sin(angle),    cos(angle),     0.0   ),\r\n\t\tvec3(   0.0,           0.0,            1.0   )\r\n\t);\r\n}",gt.scale="mat3 scale( float x, float y, float z ) {\r\n\treturn mat3(\r\n\t\tvec3(   x,      0.0,    0.0   ),\r\n\t\tvec3(   0.0,    y,      0.0   ),\r\n\t\tvec3(   0.0,    0.0,    z     )\r\n\t);\r\n}",gt.bayerMatrixDither=m,gt.linearGradient=O,gt.loopValue=dt,gt.simplex3D=pt,gt.floatPack=vt.glsl,gt.editBasic=function(t,e,r,n,i){var o="#include <common>",a="#include <begin_vertex>",s="#include <logdepthbuf_fragment>";return e&&(t.vertexShader=t.vertexShader.replace(o,o+bt+e)),r&&(t.vertexShader=t.vertexShader.replace(a,a+bt+r)),n&&(t.fragmentShader=t.fragmentShader.replace(o,o+bt+n)),i&&(t.fragmentShader=t.fragmentShader.replace(s,i+bt+"\t"+s)),gt.debug&&(console.log(t.vertexShader),console.log(t.fragmentShader)),t};var Ct=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&St(t,e)}(o,t);var e,r,n,i=Tt(o);function o(){return Pt(this,o),i.apply(this,arguments)}return e=o,r&&wt(e.prototype,r),n&&wt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(gt);Ct.edit=function(t){return gt.editBasic(t,"\nattribute float aProgress;\nvarying float vProgress;\n","\n\tvProgress = aProgress;\n","\nvarying float vProgress;\n","\n\tdiffuseColor.a *= mod( 1.0 - vProgress, 1.0 );\n")};function _t(t){return _t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_t(t)}function Dt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function zt(){return zt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=jt(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},zt.apply(this,arguments)}function jt(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Et(t)););return t}function Rt(t,e){return Rt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Rt(t,e)}function Mt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Et(t);if(e){var i=Et(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Ut(this,r)}}function Ut(t,e){if(e&&("object"===_t(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Et(t){return Et=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Et(t)}var Gt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Rt(t,e)}(o,t);var e,r,n,i=Mt(o);function o(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(e=i.call(this,t)).amplitude=.5,e.intensity=.5,e}return e=o,r=[{key:"initGUI",value:function(){zt(Et(o.prototype),"initGUI",this).call(this);var t=this.gui,e=this.sketch,r=t.addFolder("Colors");r.addColor(e.background,"color1").name("background1"),r.addColor(e.background,"color2").name("background2"),r.addColor(e.grid.material,"color");var n=t.addFolder("Bloom");n.add(e.effects.passes.bloom,"strength",0,1),n.add(e.effects.passes.bloom,"radius",0,1),n.add(e.effects.passes.bloom,"threshold",0,1)}},{key:"tick",value:function(t){var e=nt.clamp,r=nt.lerp,n=this.sketch,i=this.tracker,o=n.settings,a=e(o.lerpSpeed*t,0,1);this.cameraRigEnabled&&this.cameraRig.update(i.reversePolarizeX,i.reverseY).tick(t);var s=i.x;this.amplitude=r(this.amplitude,s,a);var l=n.shader.uniforms.uNoiseScale.value;l.x=r(o.noiseScaleX.min,o.noiseScaleX.max,this.amplitude),l.y=r(o.noiseScaleY.min,o.noiseScaleY.max,this.amplitude),n.shader.uniforms.uAmp.value=r(o.amp.min,o.amp.max,this.amplitude);var u=i.y;this.intensity=r(this.intensity,u,a),n.grid.material.opacity=r(o.opacity.min,o.opacity.max,this.intensity),o.speed.value=r(o.speed.min,o.speed.max,this.intensity)}}],r&&Dt(e.prototype,r),n&&Dt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(nt),Bt={name:"Navscan",tilesX:400,tilesZ:200,tileWidth:.4,tileDepth:.4,background:{color1:"#003e8f",color2:"#680085"},material:{color:"#ff582e",opacity:.8,transparent:!0},offsetZ:10,camera:{start:{x:0,y:0,z:5},lookAt:{x:0,y:0,z:-5}},cameraRig:{bounds:{x:5,y:10,z:0}},bloom:{strength:.8,radius:.8,threshold:.25},lerpSpeed:7e-4,noiseScaleX:{min:.01,max:.25},noiseScaleY:{min:0,max:.1},amp:{min:1,max:2.5},opacity:{min:.4,max:.8},speed:{min:.002,max:.012,value:.01}};function Ft(t){return Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ft(t)}function At(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Xt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Yt(t,e){return Yt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Yt(t,e)}function Vt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Lt(t);if(e){var i=Lt(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return It(this,r)}}function It(t,e){if(e&&("object"===Ft(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Lt(t){return Lt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Lt(t)}var Nt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Yt(t,e)}(o,t);var e,r,n,i=Vt(o);function o(){return Xt(this,o),i.apply(this,arguments)}return e=o,r&&At(e.prototype,r),n&&At(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(gt),Zt="\nuniform float uAmp;\nuniform float uDistance;\nuniform vec3 uNoiseScale;\n\n".concat(gt.simplex3D,"\n");function Wt(t){return Wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wt(t)}function Ht(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Qt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function qt(){return qt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=Kt(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},qt.apply(this,arguments)}function Kt(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ee(t)););return t}function Jt(t,e){return Jt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Jt(t,e)}function $t(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=ee(t);if(e){var i=ee(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return te(this,r)}}function te(t,e){if(e&&("object"===Wt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ee(t){return ee=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ee(t)}Nt.edit=function(t){return gt.editBasic(t,Zt,"\n\t// Z\n\ttransformed.z += mod( uDistance, 0.4 );\n\n\t// Y\n\tfloat x = position.x;\n\tfloat z = uDistance - transformed.z;\n\tfloat noise = simplex3D( \n\t\tx * uNoiseScale.x,\n\t\tmod( x, 2.0 ) *uNoiseScale.y,\n\t\tz * uNoiseScale.z\n\t);\n\n\tfloat largeNoise = uAmp * (\n\t\tsimplex3D( x * 0.03, z * 0.03, uNoiseScale.x ) * 0.7 - 1.0\n\t);\n\n\ttransformed.y = uAmp * ( clamp( noise * uAmp, -0.3, 0.3 ) + largeNoise );\n")};var re=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Jt(t,e)}(a,e);var r,n,i,o=$t(a);function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Ht(this,a),o.call(this,{defaults:Bt,settings:t})}return r=a,(n=[{key:"init",value:function(){this.effects.add("bloom",new T(this.settings.bloom)),qt(ee(a.prototype),"init",this).call(this,Gt)}},{key:"initScene",value:function(){var e=this.settings,r=e.tilesX,n=e.tilesZ,i=e.tileWidth,o=e.tileDepth,a=-r*i/2,s=-n*o,l=r+1,u=r*n,c=l*(n+1),f=8*u;this.debug&&console.log({points:c,tiles:u});for(var h=new Float32Array(3*f),d=new Float32Array(c),p=new Float32Array(c),v=0,m=0,y=0,b=0,g=0;g<c;g++)d[v++]=a+i*y,p[m++]=s+o*b,0==(y=(y+1)%l)&&b++;var x,w,P,S,T=0,k=0,O=0;y=0,b=0;for(var C=function(t){h[T++]=d[t],h[T++]=0,h[T++]=p[t]},_=function(t,e){C(t),C(e)},D=0;D<u;D++)S=(P=D+l+O)+1,_(x=D+O,w=x+1),_(w,S),_(S,P),_(P,x),0==(k=(k+1)%r)&&O++;var z=new t.BufferGeometry;z.setAttribute("position",new t.BufferAttribute(h,3));var j=new t.LineBasicMaterial(this.settings.material);j.onBeforeCompile=this.initShader.bind(this);var R=new t.LineSegments(z,j);R.position.set(0,0,this.settings.offsetZ),this.add(R),this.grid=R,this.shader={uniforms:{uAmp:{value:2},uDistance:{value:0},uNoiseScale:{value:new t.Vector3(.1,.03,.07)}}}}},{key:"initShader",value:function(t){Nt.edit(t),Object.assign(t.uniforms,this.shader.uniforms),this.shader=t}},{key:"tick",value:function(t){this.shader.uniforms.uDistance.value+=this.settings.speed.value*t,qt(ee(a.prototype),"tick",this).call(this,t)}}])&&Qt(r.prototype,n),i&&Qt(r,i),Object.defineProperty(r,"prototype",{writable:!1}),a}(ht);function ne(t){return ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ne(t)}function ie(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function oe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ae(t,e){return ae=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ae(t,e)}function se(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=ue(t);if(e){var i=ue(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return le(this,r)}}function le(t,e){if(e&&("object"===ne(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ue(t){return ue=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ue(t)}var ce=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ae(t,e)}(o,t);var e,r,n,i=se(o);function o(){return oe(this,o),i.apply(this,arguments)}return e=o,r&&ie(e.prototype,r),n&&ie(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(gt),fe="\nattribute vec3 aOffset;\nuniform float uAmplitude;\nuniform float uScale;\nuniform float uTime;\nuniform float uThickness;\nuniform float uTurbulence;\nuniform vec3 uCursor;\nvarying float vHeight;\n\n".concat(gt.simplex3D,"\n");ce.edit=function(t){return gt.editBasic(t,fe,"\n\ttransformed += aOffset;\n\n\tfloat distanceToCursor = length( uCursor - aOffset );\n\tfloat force = - 1.0 / ( 1.618 + sqrt( distanceToCursor ) );\n\n\tfloat waves = simplex3D(\n\t\tuScale * 0.02 * aOffset.x, \n\t\tdistanceToCursor * 0.1 - uTime,\n\t\tuScale * 0.02 * aOffset.z\n\t) * force * 8.0;\n\n\tfloat turbulence = simplex3D(\n\t\taOffset.x * uScale,\n\t\taOffset.z * uScale,\n\t\tuTime\n\t) * uTurbulence;\n\n\tfloat noise = abs( uThickness + waves + turbulence );\n\n\ttransformed.y *= position.y * noise * uAmplitude;\n\n\tvHeight = transformed.y;\n","\nuniform vec3 uHighColor;\nvarying float vHeight;\n","\n\tdiffuseColor.rgb = mix( diffuse, uHighColor, vHeight );\n")};function he(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function de(t,e,r){return e&&he(t.prototype,e),r&&he(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}var pe=de((function e(r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),n||(n=Pe.getTextureSize(r.length));var i=Pe.createDataTexture(n);return i.needsUpdate=!0,Pe.FloatPack.pack(r,i.image.data),new t.Uniform(i)}));function ve(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function me(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var ye=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.data,i=r.defaultValue,o=r.textureSize,a=r.length,s=void 0===a?65536:a,l=r.name,u=void 0===l?"data":l,c=r.prefix,f=void 0===c?"GPGPU_":c,h=r.shader,d=void 0===h?e.fragmentShader:h,p=r.uniforms,v=void 0===p?{}:p;if(ve(this,e),!Pe.renderer)throw new Error("Use GPUVariable.init( renderer ) before instancing.");n?s=n.length:o&&(s=o*o),o||(o=Pe.getTextureSize(s)),this.textureSize=o,this.rt1=Pe.createRenderTarget(o),this.rt2=Pe.createRenderTarget(o),this.renderTarget=this.rt1,this.dataTexture=Pe.createDataTexture(o),this.dataTexture.needsUpdate=!0,n?this.write(n):(n=this.createDataArray(i),i&&this.write(n)),this.output=new t.Uniform(this.dataTexture),this.name=f?f+u:u,this.uniforms=v,this.uniforms[this.name]=this.output,this.material=new t.ShaderMaterial({uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:d});var m=o.toFixed(1);this.material.defines.resolution="vec2( ".concat(m,", ").concat(m," )")}var r,n,i;return r=e,(n=[{key:"update",value:function(){this.renderTarget=this.renderTarget===this.rt1?this.rt2:this.rt1,Pe.render(this.material,this.renderTarget),this.output.value=this.renderTarget.texture}},{key:"dispose",value:function(){this.rt1.dispose(),this.rt2.dispose(),this.dataTexture.dispose(),this.material.dispose()}},{key:"createDataArray",value:function(t){var e=new Float32Array(this.textureSize*this.textureSize);return t&&e.fill(t),e}},{key:"read",value:function(){Pe.renderer.readRenderTargetPixels(this.renderTarget,0,0,this.textureSize,this.textureSize,this.buffer);var t=this.createDataArray();return vt.unpack(this.buffer,t),t}},{key:"write",value:function(t){vt.pack(t,this.buffer)}},{key:"buffer",get:function(){return this.dataTexture.image.data}}])&&me(r.prototype,n),i&&me(r,i),Object.defineProperty(r,"prototype",{writable:!1}),e}();function be(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function ge(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?be(Object(r),!0).forEach((function(e){xe(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):be(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function xe(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function we(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}ye.vertexShader="\n    void main() {\n\n        gl_Position = vec4( position, 1.0 );\n\n    }\n",ye.fragmentShader="\n    uniform sampler2D GPGPU_data;\n\n    ".concat(vt.glsl,"\n\n    void main() {\n        \n        vec2 uv = gl_FragCoord.xy / resolution.xy;\n        float data = unpackFloat( texture2D( GPGPU_data, uv ) );\n\n        // Modify data...\n\n        gl_FragColor = packFloat( data );\n\n    }\n");var Pe=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._textureSize=t.getTextureSize(e),this.variables={}}var e,r,n;return e=t,r=[{key:"addVariable",value:function(t,e){var r=new ye(ge(ge({},e),{},{name:t,textureSize:this._textureSize}));this.variables[t]=r,this[t]=r.output}},{key:"addConstant",value:function(t,e){this[t]=new pe(e,this._textureSize)}},{key:"assign",value:function(t,e){var r=this.variables[t],n=this.variables[e];r.uniforms[n.name]=n.output}},{key:"tick",value:function(){Object.values(this.variables).forEach((function(t){return t.update()}))}},{key:"textureSize",get:function(){return this._textureSize}}],r&&we(e.prototype,r),n&&we(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();Pe.init=function(e){if(!Pe.renderer){Pe.renderer=e;Pe.isSupported=!0,Pe.renderer.capabilities.maxVertexTextures||(console.warn("No support for vertex textures."),Pe.isSupported=!1),Pe.isSupported||window.alert("Incompatible hardware."),Pe.isSupported&&(Pe.renderer=e,Pe.scene=new t.Scene,Pe.camera=new t.OrthographicCamera,Pe.mesh=new t.Mesh(new t.PlaneGeometry(2,2)),Pe.scene.add(Pe.mesh))}},Pe.getTextureSize=function(t){if(isNaN(t)||!isFinite(t)||!Number.isInteger(t)||t<1)throw new RangeError("Parameter must be an int > 0 ");for(var e=1,r=2;r*r<t;)r=Math.pow(2,e),e++;return r},Pe.createDataTexture=function(e){return new t.DataTexture(new Uint8Array(e*e*4),e,e,t.RGBAFormat,t.UnsignedByteType)},Pe.createRenderTarget=function(e){return new t.WebGLRenderTarget(e,e,{wrapS:t.ClampToEdgeWrapping,wrapT:t.ClampToEdgeWrapping,minFilter:t.NearestFilter,magFilter:t.NearestFilter,stencilBuffer:!1,depthBuffer:!1,format:t.RGBAFormat,type:t.UnsignedByteType})},Pe.render=function(t,e){Pe.mesh.material=t,Pe.renderer.setRenderTarget(e),Pe.renderer.render(Pe.scene,Pe.camera),Pe.renderer.setRenderTarget(null)},Pe.FloatPack=vt;const Se="\nuniform sampler2D GPGPU_x;\nuniform sampler2D GPGPU_y;\nuniform sampler2D GPGPU_z;\nuniform float uEpsilon;\nuniform float uCurlScale;\nuniform float uCurlSpeed;\nuniform float uDelta;\nuniform float uTime;\nuniform vec3 uBounds;\nuniform vec3 uCurlStrength;\nuniform vec3 uWind;\n".concat(vt.glsl,"\n").concat(dt,"\n").concat(pt,"\n\nvoid main() {\n\t\n\t// Read\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\tfloat x = unpackFloat( texture2D( GPGPU_x, uv ) );\n\tfloat y = unpackFloat( texture2D( GPGPU_y, uv ) );\n\tfloat z = unpackFloat( texture2D( GPGPU_z, uv ) );\n\n\t// Curl\n\n\tfloat scaledX = ( x + uTime ) * uCurlScale;\n\tfloat scaledY = ( y + uTime ) * uCurlScale;\n\tfloat scaledZ = ( z + uTime ) * uCurlScale;\n\n\tfloat noiseY1 = simplex3D( scaledX, scaledY + uEpsilon, scaledZ );\n\tfloat noiseY2 = simplex3D( scaledX, scaledY - uEpsilon, scaledZ );\n\tfloat noiseY = noiseY1 - noiseY2;\n\n\tfloat noiseZ1 = simplex3D( scaledX, scaledY, scaledZ + uEpsilon );\n\tfloat noiseZ2 = simplex3D( scaledX, scaledY, scaledZ - uEpsilon );\n\tfloat noiseZ = noiseZ1 - noiseZ2;\n\n\t// epsilon * 2 division applied in uCurlSpeed to save calculations\n\tfloat curl = ( noiseY - noiseZ ) * uCurlSpeed;\n\n\t// Write\n\n\tfloat wind =  uWind.x + simplex3D( uTime, uv.x * 0.1, uv.y * 0.1 );\n\tfloat noise = mix( wind, curl, uCurlStrength.x ) + uWind.x;\n\tx = mix( x, x + noise, uDelta );\n\tx = loopValue( x, uBounds.x, uBounds.z );\n\n\tgl_FragColor = packFloat( x );\n\n}\n"),Te="\nuniform sampler2D GPGPU_x;\nuniform sampler2D GPGPU_y;\nuniform sampler2D GPGPU_z;\nuniform float uCurlScale;\nuniform float uCurlSpeed;\nuniform float uDelta;\nuniform float uEpsilon;\nuniform vec3 uBounds;\nuniform vec3 uCurlStrength;\nuniform vec3 uWind;\n".concat(vt.glsl,"\n").concat(dt,"\n").concat(pt,"\n\nvoid main() {\n\t\n\t// Read\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\tfloat x = unpackFloat( texture2D( GPGPU_x, uv ) );\n\tfloat y = unpackFloat( texture2D( GPGPU_y, uv ) );\n\tfloat z = unpackFloat( texture2D( GPGPU_z, uv ) );\n\n\t// Curl\n\n\tfloat scaledX = x * uCurlScale;\n\tfloat scaledY = y * uCurlScale;\n\tfloat scaledZ = z * uCurlScale;\n\n\tfloat noiseZ1 = simplex3D( scaledX, scaledY, scaledZ + uEpsilon );\n\tfloat noiseZ2 = simplex3D( scaledX, scaledY, scaledZ - uEpsilon );\n\tfloat noiseZ = noiseZ1 - noiseZ2;\n\n\tfloat noiseX1 = simplex3D( scaledX + uEpsilon, scaledY, scaledZ );\n\tfloat noiseX2 = simplex3D( scaledX - uEpsilon, scaledY, scaledZ );\n\tfloat noiseX = noiseX1 - noiseX2;\n\n\tfloat curl = ( noiseZ - noiseX ) * uCurlSpeed;\n\n\t// Write\n\n\tfloat noise = mix( uWind.y, curl, uCurlStrength.y ) + uWind.y;\n\ty = mix( y, y + noise, uDelta );\n\ty = loopValue( y, uBounds.x, uBounds.z );\n\n\tgl_FragColor = packFloat( y );\n\n}\n"),ke="\nuniform sampler2D GPGPU_x;\nuniform sampler2D GPGPU_y;\nuniform sampler2D GPGPU_z;\nuniform float uCurlScale;\nuniform float uCurlSpeed;\nuniform float uDelta;\nuniform float uEpsilon;\nuniform vec3 uBounds;\nuniform vec3 uCurlStrength;\nuniform vec3 uWind;\n".concat(vt.glsl,"\n").concat(dt,"\n").concat(pt,"\n\nvoid main() {\n\t\n\t// Read\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\tfloat x = unpackFloat( texture2D( GPGPU_x, uv ) );\n\tfloat y = unpackFloat( texture2D( GPGPU_y, uv ) );\n\tfloat z = unpackFloat( texture2D( GPGPU_z, uv ) );\n\n\t// Curl\n\n\tfloat scaledX = x * uCurlScale;\n\tfloat scaledY = y * uCurlScale;\n\tfloat scaledZ = z * uCurlScale;\n\n\tfloat noiseX1 = simplex3D( scaledX + uEpsilon, scaledY, scaledZ );\n\tfloat noiseX2 = simplex3D( scaledX - uEpsilon, scaledY, scaledZ );\n\tfloat noiseX = noiseX1 - noiseX2;\n\n\tfloat noiseY1 = simplex3D( scaledX, scaledY + uEpsilon, scaledZ );\n\tfloat noiseY2 = simplex3D( scaledX, scaledY - uEpsilon, scaledZ );\n\tfloat noiseY = noiseY1 - noiseY2;\n\n\tfloat curl = ( noiseX - noiseY ) * uCurlSpeed;\n\n\t// Write\n\n\tfloat noise = curl * uCurlStrength.z * uWind.z;\n\tz = mix( z, z + noise, uDelta );\n\tz = clamp( z, uBounds.x, uBounds.y );\n\n\tgl_FragColor = packFloat( z );\n\n}\n");function Oe(t){return Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Oe(t)}function Ce(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function De(t,e){return De=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},De(t,e)}function ze(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Re(t);if(e){var i=Re(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return je(this,r)}}function je(t,e){if(e&&("object"===Oe(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Re(t){return Re=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Re(t)}var Me=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&De(t,e)}(o,t);var e,r,n,i=ze(o);function o(){return _e(this,o),i.apply(this,arguments)}return e=o,r&&Ce(e.prototype,r),n&&Ce(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(gt);Me.GPGPU_x=Se,Me.GPGPU_y=Te,Me.GPGPU_z=ke;var Ue="\nattribute float aNoise;\nattribute vec2 GPGPU_target;\nuniform float uRotation;\nuniform float uTime;\nuniform sampler2D GPGPU_x;\nuniform sampler2D GPGPU_y;\nuniform sampler2D GPGPU_z;\nuniform vec3 uBounds;\nuniform vec3 uScale;\nvarying float vAltitude;\n\n".concat(gt.rotateZ,"\n").concat(gt.floatPack,"\n");Me.edit=function(t){return gt.editBasic(t,Ue,"\n\tfloat translateX = unpackFloat( texture2D( GPGPU_x, GPGPU_target ) );\n\tfloat translateY = unpackFloat( texture2D( GPGPU_y, GPGPU_target ) );\n\tfloat translateZ = unpackFloat( texture2D( GPGPU_z, GPGPU_target ) );\n\n\tvAltitude = mix( 1.0, 0.0, ( translateY - uBounds.x ) / uBounds.z );\n\t\n\tfloat scale = mix( \n\t\tuScale.x,\n\t\tuScale.y,\n\t\tvAltitude * mix( uScale.z, 1.0, aNoise )\n\t);\n\n\ttransformed *= scale * rotateZ( uTime * uRotation * aNoise );\n\ttransformed += vec3( translateX, translateY, translateZ );\n","\nuniform vec3 uColorTop;\nvarying float vAltitude;\n","\n\tdiffuseColor.rgb = mix( uColorTop, diffuse, vAltitude );\n")};function Ee(t){return Ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ee(t)}function Ge(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Be(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Fe(t,e){return Fe=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Fe(t,e)}function Ae(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Ye(t);if(e){var i=Ye(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Xe(this,r)}}function Xe(t,e){if(e&&("object"===Ee(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ye(t){return Ye=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ye(t)}var Ve=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Fe(t,e)}(o,t);var e,r,n,i=Ae(o);function o(){return Be(this,o),i.apply(this,arguments)}return e=o,r&&Ge(e.prototype,r),n&&Ge(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(gt);Ve.GPGPU_intensity="\n\n\tuniform sampler2D GPGPU_intensity;\n\tuniform sampler2D GPGPU_offsetX;\n\tuniform sampler2D GPGPU_offsetY;\n\tuniform vec3 uCursor;\n\tuniform float uDelta;\n\tuniform float uNoiseScale;\n\tuniform float uTime;\n\n\t".concat(gt.floatPack,"\n\t").concat(gt.simplex3D,"\n\n\tvoid main() {\n\t\n\t// Read\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\tfloat intensity = unpackFloat( texture2D( GPGPU_intensity, uv ) );\n\n\tfloat offsetX = unpackFloat( texture2D( GPGPU_offsetX, uv ) );\n\tfloat offsetY = unpackFloat( texture2D( GPGPU_offsetY, uv ) );\n\tvec3 offset = vec3( offsetX, offsetY, 0.0 );\n\n\t// Modify\n\n\tfloat simplex = simplex3D( \n\t\toffsetX * uNoiseScale, \n\t\toffsetY * uNoiseScale, \n\t\tuTime\n\t);\n\t\n\tfloat waves = ( simplex + 1.0 ) * 5.0;\n\t\n\tfloat cursorReaction = ( 0.5 + abs( simplex ) ) * clamp(\n\t\t7.0 / ( length( uCursor - offset ) + 0.1 ),\n\t\t0.0,\n\t\t10.0\n\t);\n\n\tfloat targetIntensity = clamp( \n\t\t( clamp( waves + cursorReaction, 0.0, 20.0 ) - 10.0 ) * 0.2,\n\t\t-1.0,\n\t\t1.0\n\t);\n\n\tintensity = mix( intensity, targetIntensity, uDelta );\n\n\t// Write\n\n\tgl_FragColor = packFloat( intensity );\n\n}\n");var Ie="\nattribute float aOffsetX;\nattribute float aOffsetY;\nattribute vec2 GPGPU_target;\nuniform sampler2D GPGPU_intensity;\nuniform float uDepth;\nvarying float vIntensity;\n".concat(gt.floatPack,"\n");Ve.editCore=function(t){return gt.editBasic(t,Ie,"\n\tfloat intensity = unpackFloat( texture2D( GPGPU_intensity, GPGPU_target ) );\n\tvIntensity = ( intensity + 1.0 ) / 2.0;\n\ttransformed *= vIntensity;\n\ttransformed += vec3( aOffsetX, aOffsetY, ( intensity - 1.0) * uDepth );\n","\nuniform vec3 uActiveColor;\nvarying float vIntensity;\n","\n\tdiffuseColor.rgb = mix( diffuseColor.rgb, uActiveColor, vIntensity );\n")};var Le="\nattribute float aOffsetX;\nattribute float aOffsetY;\nattribute vec2 GPGPU_target;\nuniform sampler2D GPGPU_intensity;\nuniform float uDepth;\nvarying float vIntensity;\n".concat(gt.floatPack,"\n");Ve.editShell=function(t){return gt.editBasic(t,Le,"\n\tfloat intensity = unpackFloat( texture2D( GPGPU_intensity, GPGPU_target ) );\n\tvIntensity = ( intensity + 1.0 ) / 2.0;\n\ttransformed *= vIntensity;\n\ttransformed += vec3( aOffsetX, aOffsetY, vIntensity * uDepth );\n","\nuniform vec3 uActiveColor;\nvarying float vIntensity;\n","\n\tdiffuseColor.rgb = mix( diffuseColor.rgb, uActiveColor, vIntensity );\n")};var Ne=new a({container:"background",fps:0,stats:!0}),Ze={sketchpad:Ne,gui:!0},We=function(){return new re(Ze)}();Ne.init(We)})();