(()=>{"use strict";const e=THREE;function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var r=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t(this,e),this.callbacks="function"==typeof i?[i]:i,this.fps=r,this.elapsed=0,this._last=0,this._deltaOffset=0,this._isPlaying=!1,this._update=this.update.bind(this)}var r,n,o;return r=e,(n=[{key:"add",value:function(e){this.has(e)||this.callbacks.push(e)}},{key:"remove",value:function(e){this.has(e)&&this.callbacks.splice(this.callbacks.indexOf(e),1)}},{key:"has",value:function(e){return this.callbacks.includes(e)}},{key:"reset",value:function(){this.elapsed=0}},{key:"start",value:function(){this._last=this.now,this._deltaOffset=0,this._isPlaying=!0,this.requestFrame()}},{key:"pause",value:function(){this._isPlaying=!1}},{key:"stop",value:function(){this.pause(),this.reset()}},{key:"update",value:function(){if(this.isPlaying){this.requestFrame();var t=Math.min(this.now-this._last,e.maxDelta);if(this._last=this.now,this.elapsed+=t,t>=this._frameDuration)return this.tick(t);this._deltaOffset+=t;var i=this._frameDuration-this._deltaOffset;i<=0&&(this.tick(this._frameDuration),this._deltaOffset=Math.abs(i)%this._frameDuration)}}},{key:"tick",value:function(e){var t=this;this.callbacks.forEach((function(i){return i(e,t.elapsed)}))}},{key:"requestFrame",value:function(){requestAnimationFrame(this._update)}},{key:"fps",get:function(){return this._fps},set:function(e){this._fps=e,this._frameDuration=e>0?Math.floor(1e3/e):0}},{key:"isPlaying",get:function(){return this._isPlaying}},{key:"now",get:function(){return e.time.now()}}])&&i(r.prototype,n),o&&i(r,o),Object.defineProperty(r,"prototype",{writable:!1}),e}();function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}r.maxDelta=100,r.time=Date||performance;var a=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=i.container,a=void 0===o?"sketch":o,s=i.width,l=i.height,u=i.fps,c=void 0===u?60:u,h=i.renderer,d=void 0===h?new e.WebGLRenderer({powerPreference:"high-performance",antialias:!1,stencil:!1,depth:!1}):h,f=i.debug,p=void 0!==f&&f;n(this,t),this.renderer=d,this.canvas=d.domElement,this.pixelRatio=Math.min(window.devicePixelRatio,2),"string"==typeof a&&(a=document.getElementById(a)),a||(a=document.body),a.appendChild(this.canvas),a.style.touchAction="none",this.width=s>0?s:void 0,this.height=l>0?l:void 0,this.debug=p,this.fps=p?0:c,this.onTick=this.tick.bind(this),this.ticker=new r(this.onTick,c)}var i,a,s;return i=t,a=[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sketch;this.sketch=e,this.resize(),this.sketch.init(),this.onResize=function(){this.needsResize=!0}.bind(this),window.addEventListener("resize",this.onResize),this.onTouchStart=function(e){return e.preventDefault()},this.canvas.addEventListener("touchstart",this.onTouchStart),this.tick(0,0),this.ticker.start()}},{key:"dispose",value:function(){this.ticker.stop(),window.removeEventListener("resize",this.onResize),window.removeEventListener("touchstart",this.onTouchStart)}},{key:"resize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.width,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.height;e||(e=window.innerWidth),t||(t=window.innerHeight),this.renderer.setPixelRatio(this.pixelRatio),this.renderer.setSize(e,t),this.sketch.resize(e,t,this.pixelRatio),this.needsResize=!1}},{key:"tick",value:function(e,t){this.needsResize&&this.resize(),this.sketch.tick(e,t)}}],a&&o(i.prototype,a),s&&o(i,s),Object.defineProperty(i,"prototype",{writable:!1}),t}();class s{constructor(e=Math){this.prng=e}random(){return this.prng.random()}amount(){return this.random()}number(e=0,t=1,i=!1){const r=this.random();return isNaN(e)||isNaN(t)?r:i?Math.floor(r*(t-e+1)+e):r*(t-e)+e}noise(){return this.number(-1,1)}int(e,t){return this.number(e,t,!0)}uint(e){return this.int(0,e)}boolean(){return this.random()<.5}chance(e){return this.random()<e}item(e){return e[this.uint(e.length-1)]}char(e){return e.charAt(this.uint(e.length-1))}}const l="vec3 bayerMatrixDither( vec3 color ) {\r\n\r\n\tint index = int( mod( gl_FragCoord.x - 0.5, 8.0 ) ) + \r\n\t\tint( mod( gl_FragCoord.y - 0.5, 8.0 ) * 8.0 );\r\n\r\n\tfloat bayerValue = 0.0;\r\n\r\n\t// Silly code because gl\r\n\r\n\tbayerValue = ( index == 1 ) ? 32.0 : bayerValue;\r\n\tbayerValue = ( index == 2 ) ?  8.0 : bayerValue;\r\n\tbayerValue = ( index == 3 ) ? 40.0 : bayerValue;\r\n\tbayerValue = ( index == 4 ) ?  2.0 : bayerValue;\r\n\tbayerValue = ( index == 5 ) ? 34.0 : bayerValue;\r\n\tbayerValue = ( index == 6 ) ? 10.0 : bayerValue;\r\n\tbayerValue = ( index == 7 ) ? 42.0 : bayerValue;\r\n\r\n\tbayerValue = ( index == 8 ) ? 48.0 : bayerValue;\r\n\tbayerValue = ( index == 9 ) ? 16.0 : bayerValue;\r\n\tbayerValue = ( index == 10 ) ? 56.0 : bayerValue;\r\n\tbayerValue = ( index == 11 ) ? 24.0 : bayerValue;\r\n\tbayerValue = ( index == 12 ) ? 50.0 : bayerValue;\r\n\tbayerValue = ( index == 13 ) ? 18.0 : bayerValue;\r\n\tbayerValue = ( index == 14 ) ? 58.0 : bayerValue;\r\n\tbayerValue = ( index == 15 ) ? 26.0 : bayerValue;\r\n\r\n\tbayerValue = ( index == 16 ) ? 12.0 : bayerValue;\r\n\tbayerValue = ( index == 17 ) ? 44.0 : bayerValue;\r\n\tbayerValue = ( index == 18 ) ?  4.0 : bayerValue;\r\n\tbayerValue = ( index == 19 ) ? 36.0 : bayerValue;\r\n\tbayerValue = ( index == 20 ) ? 14.0 : bayerValue;\r\n\tbayerValue = ( index == 21 ) ? 46.0 : bayerValue;\r\n\tbayerValue = ( index == 22 ) ?  6.0 : bayerValue;\r\n\tbayerValue = ( index == 23 ) ? 38.0 : bayerValue;\r\n\r\n\tbayerValue = ( index == 24 ) ? 60.0 : bayerValue;\r\n\tbayerValue = ( index == 25 ) ? 28.0 : bayerValue;\r\n\tbayerValue = ( index == 26 ) ? 52.0 : bayerValue;\r\n\tbayerValue = ( index == 27 ) ? 20.0 : bayerValue;\r\n\tbayerValue = ( index == 28 ) ? 62.0 : bayerValue;\r\n\tbayerValue = ( index == 29 ) ? 30.0 : bayerValue;\r\n\tbayerValue = ( index == 30 ) ? 54.0 : bayerValue;\r\n\tbayerValue = ( index == 31 ) ? 22.0 : bayerValue;\r\n\r\n\tbayerValue = ( index == 32 ) ?  3.0 : bayerValue;\r\n\tbayerValue = ( index == 33 ) ? 35.0 : bayerValue;\r\n\tbayerValue = ( index == 34 ) ? 11.0 : bayerValue;\r\n\tbayerValue = ( index == 35 ) ? 43.0 : bayerValue;\r\n\tbayerValue = ( index == 36 ) ?  1.0 : bayerValue;\r\n\tbayerValue = ( index == 37 ) ? 33.0 : bayerValue;\r\n\tbayerValue = ( index == 38 ) ?  9.0 : bayerValue;\r\n\tbayerValue = ( index == 39 ) ? 41.0 : bayerValue;\r\n\r\n\tbayerValue = ( index == 40 ) ? 51.0 : bayerValue;\r\n\tbayerValue = ( index == 41 ) ? 19.0 : bayerValue;\r\n\tbayerValue = ( index == 42 ) ? 59.0 : bayerValue;\r\n\tbayerValue = ( index == 43 ) ? 27.0 : bayerValue;\r\n\tbayerValue = ( index == 44 ) ? 49.0 : bayerValue;\r\n\tbayerValue = ( index == 45 ) ? 17.0 : bayerValue;\r\n\tbayerValue = ( index == 46 ) ? 57.0 : bayerValue;\r\n\tbayerValue = ( index == 47 ) ? 25.0 : bayerValue;\r\n\r\n\tbayerValue = ( index == 48 ) ? 15.0 : bayerValue;\r\n\tbayerValue = ( index == 49 ) ? 47.0 : bayerValue;\r\n\tbayerValue = ( index == 50 ) ?  7.0 : bayerValue;\r\n\tbayerValue = ( index == 51 ) ? 39.0 : bayerValue;\r\n\tbayerValue = ( index == 52 ) ? 13.0 : bayerValue;\r\n\tbayerValue = ( index == 53 ) ? 45.0 : bayerValue;\r\n\tbayerValue = ( index == 54 ) ?  5.0 : bayerValue;\r\n\tbayerValue = ( index == 55 ) ? 37.0 : bayerValue;\r\n\r\n\tbayerValue = ( index == 56 ) ? 63.0 : bayerValue;\r\n\tbayerValue = ( index == 57 ) ? 31.0 : bayerValue;\r\n\tbayerValue = ( index == 58 ) ? 55.0 : bayerValue;\r\n\tbayerValue = ( index == 59 ) ? 23.0 : bayerValue;\r\n\tbayerValue = ( index == 60 ) ? 61.0 : bayerValue;\r\n\tbayerValue = ( index ==\t61 ) ? 29.0 : bayerValue;\r\n\tbayerValue = ( index == 62 ) ? 53.0 : bayerValue;\r\n\tbayerValue = ( index == 63 ) ? 21.0 : bayerValue;\r\n\r\n\tfloat dithering = ( bayerValue / 255.0 ) / 32.0 - ( 1.0 / 128.0 );\r\n\r\n\treturn color + dithering;\r\n\t\r\n}";function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function c(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function h(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?c(Object(i),!0).forEach((function(t){d(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):c(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function d(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t){return v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},v(e,t)}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,r=b(e);if(t){var n=b(this).constructor;i=Reflect.construct(r,arguments,n)}else i=r.apply(this,arguments);return g(this,i)}}function g(e,t){if(t&&("object"===u(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function b(e){return b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},b(e)}var y=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&v(e,t)}(a,t);var i,r,n,o=m(a);function a(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=i.color1,n=void 0===r?16777215:r,s=i.color2,l=void 0===s?0:s,u=i.angle,c=void 0===u?90:u;f(this,a);var d=new e.PlaneGeometry(2,2),p=new e.ShaderMaterial(h(h({},a.shader),{},{uniforms:{uAngle:{value:c},uColor1:{value:new e.Color(n)},uColor2:{value:new e.Color(l)}}}));return(t=o.call(this,d,p)).frustumCulled=!1,t}return i=a,(r=[{key:"angle",get:function(){return this.material.uniforms.uAngle.value},set:function(e){this.material.uniforms.uAngle.value=e}},{key:"color1",get:function(){return this.material.uniforms.uColor1.value},set:function(e){this.material.uniforms.uColor1.value=e}},{key:"color2",get:function(){return this.material.uniforms.uColor2.value},set:function(e){this.material.uniforms.uColor2.value=e}}])&&p(i.prototype,r),n&&p(i,n),Object.defineProperty(i,"prototype",{writable:!1}),a}(e.Mesh);y.shader={depthWrite:!1,depthTest:!1,vertexShader:"varying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n\tvUv = uv;\r\n\r\n\tgl_Position = vec4( position, 1.0 );\r\n\r\n}",fragmentShader:"\n\t\tuniform float uAngle;\n\t\tuniform vec3 uColor1;\n\t\tuniform vec3 uColor2;\n\t\tvarying vec2 vUv;\n\t\t\n\t\t".concat("vec3 linearGradient( \r\n\tvec2 origin,\r\n\tvec2 target,\r\n\tvec3 color1,\r\n\tvec3 color2,\r\n\tfloat angle\r\n) {\r\n\r\n\tfloat toTarget = length( target );\r\n\tangle = radians( angle ) + atan( target.y, target.x );\r\n\r\n\tfloat progressX = cos( angle ) * toTarget;\r\n\tfloat progressY = sin( angle ) * toTarget;\r\n\tvec2 progress = vec2( progressX, progressY ) + origin;\r\n\r\n\treturn mix( color1, color2, smoothstep( 0.0, 1.0, progress.x ) );\r\n\t\r\n}","\n\t\t").concat(l,"\n\n\t\tvoid main() {\n\n\t\t\tvec2 origin = vec2( 0.5, 0.5 );\n\t\t\tvec2 target = vUv - origin;\n\t\t\tvec3 color = linearGradient( origin, target, uColor1, uColor2, uAngle );\n\t\t\t\n\t\t\tcolor = bayerMatrixDither( color );\n\n\t\t\tgl_FragColor = vec4( color, 1.0 );\n\t\t\t\n\t\t}")};var x={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\t\t}"};class w{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const A=new e.OrthographicCamera(-1,1,1,-1,0,1),k=new e.BufferGeometry;k.setAttribute("position",new e.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),k.setAttribute("uv",new e.Float32BufferAttribute([0,2,0,0,2,0],2));class _{constructor(t){this._mesh=new e.Mesh(k,t)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,A)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class C extends w{constructor(t,i){super(),this.textureID=void 0!==i?i:"tDiffuse",t instanceof e.ShaderMaterial?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=e.UniformsUtils.clone(t.uniforms),this.material=new e.ShaderMaterial({defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.fsQuad=new _(this.material)}render(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}}class S extends w{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){const r=e.getContext(),n=e.state;let o,a;n.buffers.color.setMask(!1),n.buffers.depth.setMask(!1),n.buffers.color.setLocked(!0),n.buffers.depth.setLocked(!0),this.inverse?(o=0,a=1):(o=1,a=0),n.buffers.stencil.setTest(!0),n.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),n.buffers.stencil.setFunc(r.ALWAYS,o,4294967295),n.buffers.stencil.setClear(a),n.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),n.buffers.color.setLocked(!1),n.buffers.depth.setLocked(!1),n.buffers.stencil.setLocked(!1),n.buffers.stencil.setFunc(r.EQUAL,1,4294967295),n.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),n.buffers.stencil.setLocked(!0)}}class P extends w{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class E{constructor(t,i){if(this.renderer=t,void 0===i){const r={minFilter:e.LinearFilter,magFilter:e.LinearFilter,format:e.RGBAFormat},n=t.getSize(new e.Vector2);this._pixelRatio=t.getPixelRatio(),this._width=n.width,this._height=n.height,(i=new e.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,r)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=i.width,this._height=i.height;this.renderTarget1=i,this.renderTarget2=i.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===x&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===C&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new C(x),this.clock=new e.Clock}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let i=!1;for(let t=0,r=this.passes.length;t<r;t++){const r=this.passes[t];if(!1!==r.enabled){if(r.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(t),r.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),r.needsSwap){if(i){const t=this.renderer.getContext(),i=this.renderer.state.buffers.stencil;i.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),i.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==S&&(r instanceof S?i=!0:r instanceof P&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(t){if(void 0===t){const i=this.renderer.getSize(new e.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=i.width,this._height=i.height,(t=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(i,r),this.renderTarget2.setSize(i,r);for(let e=0;e<this.passes.length;e++)this.passes[e].setSize(i,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}new e.OrthographicCamera(-1,1,1,-1,0,1);const V=new e.BufferGeometry;V.setAttribute("position",new e.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),V.setAttribute("uv",new e.Float32BufferAttribute([0,2,0,0,2,0],2));class T extends w{constructor(t,i,r,n,o){super(),this.scene=t,this.camera=i,this.overrideMaterial=r,this.clearColor=n,this.clearAlpha=void 0!==o?o:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new e.Color}render(e,t,i){const r=e.autoClear;let n,o;e.autoClear=!1,void 0!==this.overrideMaterial&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),n=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,n),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=o),e.autoClear=r}}function z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function M(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var D=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=i.renderer,n=i.stage,o=i.useRenderTarget,a=void 0!==o&&o;z(this,t),a&&(this.renderTarget=new e.WebGLRenderTarget),this.composer=new E(r,this.renderTarget),this.composer.renderToScreen=!a,this.passes={},this.add("render",new T(n.scene,n.camera))}var i,r,n;return i=t,(r=[{key:"add",value:function(e,t){this.passes[e]=t,this.composer.addPass(t)}},{key:"remove",value:function(e){var t,i=this.passes[e];i&&(this.composer.removePass(i),null==i||null===(t=i.dispose)||void 0===t||t.call(i),delete this.passes[e])}},{key:"resize",value:function(e,t,i){this.composer.setSize(e,t),Object.values(this.passes).forEach((function(r){return null==r?void 0:r.setSize(e,t,i)}))}},{key:"tick",value:function(){this.composer.render()}},{key:"dispose",value:function(){Object.values(this.passes).forEach((function(e){var t;return null==e||null===(t=e.dispose)||void 0===t?void 0:t.call(e)})),Object.values(this).forEach((function(e){var t;return null==e||null===(t=e.dispose)||void 0===t?void 0:t.call(e)}))}}])&&M(i.prototype,r),n&&M(i,n),Object.defineProperty(i,"prototype",{writable:!1}),t}();
/**
 * lil-gui
 * https://lil-gui.georgealways.com
 * @version 0.11.0
 * @author George Michael Brower
 * @license MIT
 */
class O{constructor(e,t,i,r,n="div"){this.parent=e,this.object=t,this.property=i,this._disabled=!1,this.initialValue=this.getValue(),this.domElement=document.createElement("div"),this.domElement.classList.add("controller"),this.domElement.classList.add(r),this.$name=document.createElement("div"),this.$name.classList.add("name"),O.nextNameID=O.nextNameID||0,this.$name.id="lil-gui-name-"+ ++O.nextNameID,this.$widget=document.createElement(n),this.$widget.classList.add("widget"),this.$disable=this.$widget,this.domElement.appendChild(this.$name),this.domElement.appendChild(this.$widget),this.parent.children.push(this),this.parent.controllers.push(this),this.parent.$children.appendChild(this.domElement),this._listenCallback=this._listenCallback.bind(this),this.name(i)}name(e){return this._name=e,this.$name.innerHTML=e,this}onChange(e){return this._onChange=e,this}_callOnChange(){this.parent._callOnChange(this),void 0!==this._onChange&&this._onChange.call(this,this.getValue())}onFinishChange(e){return this.onChange(e)}reset(){return this.setValue(this.initialValue),this}enable(e=!0){return this.disable(!e)}disable(e=!0){return e===this._disabled||(this._disabled=e,this.domElement.classList.toggle("disabled",e),e?this.$disable.setAttribute("disabled","disabled"):this.$disable.removeAttribute("disabled")),this}options(e){const t=this.parent.add(this.object,this.property,e);return t.name(this._name),this.destroy(),t}min(e){return this}max(e){return this}step(e){return this}listen(e=!0){return this._listening=e,void 0!==this._listenCallbackID&&(cancelAnimationFrame(this._listenCallbackID),this._listenCallbackID=void 0),this._listening&&this._listenCallback(),this}_listenCallback(){this._listenCallbackID=requestAnimationFrame(this._listenCallback);const e=this.getValue();e===this._listenValuePrev&&Object(e)!==e||this.updateDisplay(),this._listenValuePrev=e}getValue(){return this.object[this.property]}setValue(e){return this.object[this.property]=e,this._callOnChange(),this.updateDisplay(),this}updateDisplay(){return this}load(e){this.setValue(e)}save(){return this.getValue()}destroy(){this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.controllers.splice(this.parent.controllers.indexOf(this),1),this.parent.$children.removeChild(this.domElement)}}class $ extends O{constructor(e,t,i){super(e,t,i,"boolean","label"),this.$input=document.createElement("input"),this.$input.setAttribute("type","checkbox"),this.$widget.appendChild(this.$input),this.$input.addEventListener("change",(()=>{this.setValue(this.$input.checked)})),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.checked=this.getValue(),this}}function B(e){let t,i;return(t=e.match(/(#|0x)?([a-f0-9]{6})/i))?i=t[2]:(t=e.match(/rgb\(\s*(\d*)\s*,\s*(\d*)\s*,\s*(\d*)\s*\)/))?i=parseInt(t[1]).toString(16).padStart(2,0)+parseInt(t[2]).toString(16).padStart(2,0)+parseInt(t[3]).toString(16).padStart(2,0):(t=e.match(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i))&&(i=t[1]+t[1]+t[2]+t[2]+t[3]+t[3]),!!i&&"#"+i}const G={isPrimitive:!0,match:e=>"string"==typeof e,fromHexString:B,toHexString:B},U={isPrimitive:!0,match:e=>"number"==typeof e,fromHexString:e=>parseInt(e.substring(1),16),toHexString:e=>"#"+e.toString(16).padStart(6,0)},j={isPrimitive:!1,match:Array.isArray,fromHexString(e,t,i=1){const r=U.fromHexString(e);t[0]=(r>>16&255)/255*i,t[1]=(r>>8&255)/255*i,t[2]=(255&r)/255*i},toHexString:([e,t,i],r=1)=>U.toHexString(e*(r=255/r)<<16^t*r<<8^i*r<<0)},F={isPrimitive:!1,match:e=>Object(e)===e,fromHexString(e,t,i=1){const r=U.fromHexString(e);t.r=(r>>16&255)/255*i,t.g=(r>>8&255)/255*i,t.b=(255&r)/255*i},toHexString:({r:e,g:t,b:i},r=1)=>U.toHexString(e*(r=255/r)<<16^t*r<<8^i*r<<0)},R=[G,U,j,F];class L extends O{constructor(e,t,i,r){var n;super(e,t,i,"color"),this.$input=document.createElement("input"),this.$input.setAttribute("type","color"),this.$input.setAttribute("tabindex",-1),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$text=document.createElement("input"),this.$text.setAttribute("type","text"),this.$text.setAttribute("spellcheck","false"),this.$text.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$display.appendChild(this.$input),this.$widget.appendChild(this.$display),this.$widget.appendChild(this.$text),this._format=(n=this.initialValue,R.find((e=>e.match(n)))),this._rgbScale=r,this._initialValueHexString=this.save(),this._textFocused=!1;const o=()=>{this._setValueFromHexString(this.$input.value)};this.$input.addEventListener("change",o),this.$input.addEventListener("input",o),this.$input.addEventListener("focus",(()=>{this.$display.classList.add("focus")})),this.$input.addEventListener("blur",(()=>{this.$display.classList.remove("focus")})),this.$text.addEventListener("input",(()=>{const e=B(this.$text.value);e&&this._setValueFromHexString(e)})),this.$text.addEventListener("focus",(()=>{this._textFocused=!0,this.$text.select()})),this.$text.addEventListener("blur",(()=>{this._textFocused=!1,this.updateDisplay()})),this.$disable=this.$text,this.updateDisplay()}reset(){return this._setValueFromHexString(this._initialValueHexString),this}_setValueFromHexString(e){if(this._format.isPrimitive){const t=this._format.fromHexString(e);this.setValue(t)}else this._format.fromHexString(e,this.getValue(),this._rgbScale),this._callOnChange(),this.updateDisplay()}save(){return this._format.toHexString(this.getValue(),this._rgbScale)}load(e){this._setValueFromHexString(e)}updateDisplay(){return this.$input.value=this._format.toHexString(this.getValue(),this._rgbScale),this._textFocused||(this.$text.value=this.$input.value.substring(1)),this.$display.style.backgroundColor=this.$input.value,this}}class I extends O{constructor(e,t,i){super(e,t,i,"function"),this.$button=document.createElement("button"),this.$button.appendChild(this.$name),this.$widget.appendChild(this.$button),this.$button.addEventListener("click",(e=>{e.preventDefault(),this.getValue().call(this.object)})),this.$button.addEventListener("touchstart",(()=>{})),this.$disable=this.$button}}class Y extends O{constructor(e,t,i,r,n,o){super(e,t,i,"number"),this._initInput(),this.min(r),this.max(n);const a=void 0!==o;this.step(a?o:this._getImplicitStep(),a),this.updateDisplay()}min(e){return this._min=e,this._onUpdateMinMax(),this}max(e){return this._max=e,this._onUpdateMinMax(),this}step(e,t=!0){return this._step=e,this._stepExplicit=t,this}updateDisplay(){const e=this.getValue();if(this._hasSlider){const t=(e-this._min)/(this._max-this._min);this.$fill.style.setProperty("width",100*t+"%")}return this._inputFocused||(this.$input.value=e),this}_initInput(){this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("inputmode","numeric"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$disable=this.$input;const e=e=>{const t=parseFloat(this.$input.value);isNaN(t)||(this._snapClampSetValue(t+e),this.$input.value=this.getValue())};this.$input.addEventListener("focus",(()=>{this._inputFocused=!0})),this.$input.addEventListener("input",(()=>{const e=parseFloat(this.$input.value);isNaN(e)||this.setValue(this._clamp(e))})),this.$input.addEventListener("blur",(()=>{this._inputFocused=!1,this.updateDisplay()})),this.$input.addEventListener("keydown",(t=>{"Enter"===t.code&&this.$input.blur(),"ArrowUp"===t.code&&(t.preventDefault(),e(this._step*this._arrowKeyMultiplier(t))),"ArrowDown"===t.code&&(t.preventDefault(),e(-1*this._step*this._arrowKeyMultiplier(t)))})),this.$input.addEventListener("wheel",(t=>{this._inputFocused&&(t.preventDefault(),e(this._normalizeMouseWheel(t)*this._step))}),{passive:!1})}_initSlider(){this._hasSlider=!0,this.$slider=document.createElement("div"),this.$slider.classList.add("slider"),this.$fill=document.createElement("div"),this.$fill.classList.add("fill"),this.$slider.appendChild(this.$fill),this.$widget.insertBefore(this.$slider,this.$input),this.domElement.classList.add("hasSlider");const e=e=>{const t=this.$slider.getBoundingClientRect();let i=(r=e,n=t.left,o=t.right,a=this._min,(r-n)/(o-n)*(this._max-a)+a);var r,n,o,a;this._snapClampSetValue(i)},t=t=>{e(t.clientX)},i=()=>{this._setActiveStyle(!1),window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",i)};this.$slider.addEventListener("mousedown",(r=>{e(r.clientX),this._setActiveStyle(!0),window.addEventListener("mousemove",t),window.addEventListener("mouseup",i)}));let r,n,o=!1;const a=t=>{if(o){const i=t.touches[0].clientX-r,l=t.touches[0].clientY-n;Math.abs(i)>Math.abs(l)?(t.preventDefault(),e(t.touches[0].clientX),this._setActiveStyle(!0),o=!1):(window.removeEventListener("touchmove",a),window.removeEventListener("touchend",s))}else t.preventDefault(),e(t.touches[0].clientX)},s=()=>{this._setActiveStyle(!1),window.removeEventListener("touchmove",a),window.removeEventListener("touchend",s)};this.$slider.addEventListener("touchstart",(t=>{t.touches.length>1||(this._hasScrollBar?(r=t.touches[0].clientX,n=t.touches[0].clientY,o=!0):(t.preventDefault(),e(t.touches[0].clientX),this._setActiveStyle(!0),o=!1),window.addEventListener("touchmove",a,{passive:!1}),window.addEventListener("touchend",s))})),this.$slider.addEventListener("wheel",(e=>{if(Math.abs(e.deltaX)<Math.abs(e.deltaY)&&this._hasScrollBar)return;e.preventDefault();const t=this._normalizeMouseWheel(e)*this._step;this._snapClampSetValue(this.getValue()+t)}),{passive:!1})}_setActiveStyle(e){this.$slider.classList.toggle("active",e),document.body.classList.toggle("lil-gui-slider-active",e)}_getImplicitStep(){return this._hasMin&&this._hasMax?(this._max-this._min)/1e3:.1}_onUpdateMinMax(){!this._hasSlider&&this._hasMin&&this._hasMax&&(this._stepExplicit||this.step(this._getImplicitStep(),!1),this._initSlider(),this.updateDisplay())}_normalizeMouseWheel(e){let{deltaX:t,deltaY:i}=e;return Math.floor(e.deltaY)!==e.deltaY&&e.wheelDelta&&(t=0,i=-e.wheelDelta/120),t+-i}_arrowKeyMultiplier(e){return this._stepExplicit?e.shiftKey?10:1:e.shiftKey?100:e.altKey?1:10}_snap(e){const t=Math.round(e/this._step)*this._step;return parseFloat(t.toPrecision(15))}_clamp(e){const t=this._hasMin?this._min:-1/0,i=this._hasMax?this._max:1/0;return Math.max(t,Math.min(i,e))}_snapClampSetValue(e){this.setValue(this._clamp(this._snap(e)))}get _hasScrollBar(){const e=this.parent.root.$children;return e.scrollHeight>e.clientHeight}get _hasMin(){return void 0!==this._min}get _hasMax(){return void 0!==this._max}}class X extends O{constructor(e,t,i,r){super(e,t,i,"option"),this.$select=document.createElement("select"),this.$select.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this._values=Array.isArray(r)?r:Object.values(r),this._names=Array.isArray(r)?r:Object.keys(r),this._names.forEach((e=>{const t=document.createElement("option");t.innerHTML=e,this.$select.appendChild(t)})),this.$select.addEventListener("change",(()=>{this.setValue(this._values[this.$select.selectedIndex])})),this.$select.addEventListener("focus",(()=>{this.$display.classList.add("focus")})),this.$select.addEventListener("blur",(()=>{this.$display.classList.remove("focus")})),this.$widget.appendChild(this.$select),this.$widget.appendChild(this.$display),this.$disable=this.$select,this.updateDisplay()}updateDisplay(){const e=this.getValue(),t=this._values.indexOf(e);return this.$select.selectedIndex=t,this.$display.innerHTML=-1===t?e:this._names[t],this}}class H extends O{constructor(e,t,i){super(e,t,i,"string"),this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$input.addEventListener("input",(()=>{this.setValue(this.$input.value)})),this.$input.addEventListener("keydown",(e=>{"Enter"===e.code&&this.$input.blur()})),this.$widget.appendChild(this.$input),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.value=this.getValue(),this}}let W=!1;class N{constructor({parent:e,autoPlace:t=void 0===e,touchStyles:i=!0,container:r,injectStyles:n=!0,title:o="Controls",width:a}={}){if(this.parent=e,this.root=e?e.root:this,this.children=[],this.controllers=[],this.folders=[],this._closed=!1,this.domElement=document.createElement("div"),this.domElement.classList.add("lil-gui"),this.$title=document.createElement("div"),this.$title.classList.add("title"),this.$title.setAttribute("role","button"),this.$title.setAttribute("aria-expanded",!0),this.$title.setAttribute("tabindex",0),this.$title.addEventListener("click",(()=>this.openAnimated(this._closed))),this.$title.addEventListener("keydown",(e=>{"Enter"!==e.code&&"Space"!==e.code||(e.preventDefault(),this.$title.click())})),this.$title.addEventListener("touchstart",(()=>{})),this.$children=document.createElement("div"),this.$children.classList.add("children"),this.domElement.appendChild(this.$title),this.domElement.appendChild(this.$children),this.title(o),this.parent)return this.parent.children.push(this),this.parent.folders.push(this),void this.parent.$children.appendChild(this.domElement);this.domElement.classList.add("root"),!W&&n&&(function(e){const t=document.createElement("style");t.innerHTML='.lil-gui{font-family:var(--font-family);font-size:var(--font-size);line-height:1;font-weight:normal;font-style:normal;text-align:left;background-color:var(--background-color);color:var(--text-color);user-select:none;-webkit-user-select:none;touch-action:manipulation;--background-color:#1f1f1f;--text-color:#ebebeb;--title-background-color:#111;--title-text-color:#ebebeb;--widget-color:#424242;--hover-color:#4f4f4f;--focus-color:#595959;--number-color:#2cc9ff;--string-color:#a2db3c;--font-size:11px;--input-font-size:11px;--font-family:-apple-system,BlinkMacSystemFont,"Lucida Grande","Segoe UI",Roboto,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--font-family-mono:Menlo,Monaco,Consolas,"Droid Sans Mono",monospace,"Droid Sans Fallback";--padding:4px;--spacing:4px;--widget-height:20px;--name-width:45%;--slider-knob-width:2px;--slider-input-width:27%;--color-input-width:27%;--slider-input-min-width:45px;--color-input-min-width:45px;--folder-indent:7px;--widget-padding:0 0 0 3px;--widget-border-radius:2px;--checkbox-size:calc(.75*var(--widget-height));--scrollbar-width: 5px}.lil-gui,.lil-gui *{box-sizing:border-box;margin:0}.lil-gui.root{width:var(--width, 245px);display:flex;flex-direction:column}.lil-gui.root>.title{background:var(--title-background-color);color:var(--title-text-color)}.lil-gui.root>.children{overflow:auto}.lil-gui.root>.children::-webkit-scrollbar{width:var(--scrollbar-width);height:var(--scrollbar-width);background:var(--background-color)}.lil-gui.root>.children::-webkit-scrollbar-thumb{border-radius:var(--scrollbar-width);background:var(--focus-color)}.lil-gui .lil-gui{--background-color:inherit;--text-color:inherit;--title-background-color:inherit;--title-text-color:inherit;--widget-color:inherit;--hover-color:inherit;--focus-color:inherit;--number-color:inherit;--string-color:inherit;--font-size:inherit;--input-font-size:inherit;--font-family:inherit;--font-family-mono:inherit;--padding:inherit;--spacing:inherit;--widget-height:inherit;--name-width:inherit;--slider-knob-width:inherit;--slider-input-width:inherit;--color-input-width:inherit;--slider-input-min-width:inherit;--color-input-min-width:inherit;--folder-indent:inherit;--widget-padding:inherit;--widget-border-radius:inherit;--checkbox-size:inherit}@media(pointer: coarse){.lil-gui.allow-touch-styles{--widget-height: 28px;--padding: 6px;--spacing: 6px;--font-size: 13px;--input-font-size: 16px;--folder-indent: 10px;--widget-padding: 0 0 0 3px;--scrollbar-width: 7px;--slider-input-min-width: 50px;--color-input-min-width: 65px}}.lil-gui.force-touch-styles{--widget-height: 28px;--padding: 6px;--spacing: 6px;--font-size: 13px;--input-font-size: 16px;--folder-indent: 10px;--widget-padding: 0 0 0 3px;--scrollbar-width: 7px;--slider-input-min-width: 50px;--color-input-min-width: 65px}.lil-gui.autoPlace{max-height:100%;position:fixed;top:0;right:15px;z-index:1001}.lil-gui .controller{display:flex;align-items:center;padding:0 var(--padding);margin:var(--spacing) 0}.lil-gui .controller.disabled{opacity:.5}.lil-gui .controller.disabled,.lil-gui .controller.disabled *{pointer-events:none !important}.lil-gui .controller .name{min-width:var(--name-width);flex-shrink:0;white-space:pre;padding-right:var(--spacing);line-height:var(--widget-height)}.lil-gui .controller .widget{position:relative;display:flex;align-items:center;width:100%;min-height:var(--widget-height)}.lil-gui .controller.function .name{line-height:unset;padding:0}.lil-gui .controller.string input{color:var(--string-color)}.lil-gui .controller.boolean .widget{cursor:pointer}.lil-gui .controller.color .display{width:100%;height:var(--widget-height);border-radius:var(--widget-border-radius);position:relative}@media(hover: hover){.lil-gui .controller.color .display:hover:before{content:" ";display:block;position:absolute;border-radius:var(--widget-border-radius);border:1px solid #fff9;left:0;right:0;top:0;bottom:0}}.lil-gui .controller.color input[type=color]{opacity:0;width:100%;height:100%;cursor:pointer}.lil-gui .controller.color input[type=text]{margin-left:var(--spacing);font-family:var(--font-family-mono);min-width:var(--color-input-min-width);width:var(--color-input-width);flex-shrink:0}.lil-gui .controller.option select{opacity:0;position:absolute;width:100%;max-width:100%}.lil-gui .controller.option .display{position:relative;pointer-events:none;border-radius:var(--widget-border-radius);height:var(--widget-height);line-height:var(--widget-height);max-width:100%;overflow:hidden;word-break:break-all;padding-left:.55em;padding-right:1.75em;background:var(--widget-color)}@media(hover: hover){.lil-gui .controller.option .display.focus{background:var(--focus-color)}}.lil-gui .controller.option .display.active{background:var(--focus-color)}.lil-gui .controller.option .display:after{font-family:"lil-gui";content:"↕";position:absolute;top:0;right:0;bottom:0;padding-right:.375em}.lil-gui .controller.option .widget,.lil-gui .controller.option select{cursor:pointer}@media(hover: hover){.lil-gui .controller.option .widget:hover .display{background:var(--hover-color)}}.lil-gui .controller.number input{color:var(--number-color)}.lil-gui .controller.number.hasSlider input{margin-left:var(--spacing);width:var(--slider-input-width);min-width:var(--slider-input-min-width);flex-shrink:0}.lil-gui .controller.number .slider{width:100%;height:var(--widget-height);background-color:var(--widget-color);border-radius:var(--widget-border-radius);padding-right:var(--slider-knob-width);overflow:hidden;cursor:ew-resize;touch-action:pan-y}@media(hover: hover){.lil-gui .controller.number .slider:hover{background-color:var(--hover-color)}}.lil-gui .controller.number .slider.active{background-color:var(--focus-color)}.lil-gui .controller.number .slider.active .fill{opacity:.95}.lil-gui .controller.number .fill{height:100%;border-right:var(--slider-knob-width) solid var(--number-color);box-sizing:content-box}.lil-gui-slider-active .lil-gui{--hover-color: var(--widget-color)}.lil-gui-slider-active *{cursor:ew-resize !important}.lil-gui .title{--title-height: calc(var(--widget-height) + var(--spacing) * 1.25);height:var(--title-height);line-height:calc(var(--title-height) - 4px);font-weight:600;padding:0 var(--padding);-webkit-tap-highlight-color:transparent;cursor:pointer;outline:none;text-decoration-skip:objects}.lil-gui .title:before{font-family:"lil-gui";content:"▾";padding-right:2px;display:inline-block}.lil-gui .title:active{background:var(--title-background-color);opacity:.75}@media(hover: hover){.lil-gui .title:hover{background:var(--title-background-color);opacity:.85}.lil-gui .title:focus{text-decoration:underline var(--focus-color)}}.lil-gui.root>.title:focus{text-decoration:none !important}.lil-gui.closed>.title:before{content:"▸"}.lil-gui.closed>.children{transform:translateY(-7px);opacity:0}.lil-gui.closed:not(.transition)>.children{display:none}.lil-gui.transition>.children{transition-duration:300ms;transition-property:height,opacity,transform;transition-timing-function:cubic-bezier(0.215, 0.61, 0.355, 1);overflow:hidden;pointer-events:none}.lil-gui .children:empty:before{content:"Empty";padding:0 var(--padding);margin:var(--spacing) 0;display:block;height:var(--widget-height);font-style:italic;line-height:var(--widget-height);opacity:.5}.lil-gui.root>.children>.lil-gui>.title{border:0 solid var(--widget-color);border-width:1px 0;transition:border-color 300ms}.lil-gui.root>.children>.lil-gui.closed>.title{border-bottom-color:transparent}.lil-gui+.controller{border-top:1px solid var(--widget-color);margin-top:0;padding-top:var(--spacing)}.lil-gui .lil-gui .lil-gui>.title{border:none}.lil-gui .lil-gui .lil-gui>.children{border:none;margin-left:var(--folder-indent);border-left:2px solid var(--widget-color)}.lil-gui .lil-gui .controller{border:none}.lil-gui input{-webkit-tap-highlight-color:transparent;border:0;outline:none;font-family:var(--font-family);font-size:var(--input-font-size);border-radius:var(--widget-border-radius);height:var(--widget-height);background:var(--widget-color);color:var(--text-color);width:100%}@media(hover: hover){.lil-gui input:hover{background:var(--hover-color)}.lil-gui input:active{background:var(--focus-color)}}.lil-gui input[type=text]{padding:var(--widget-padding)}.lil-gui input[type=text]:focus{background:var(--focus-color)}.lil-gui input[type=checkbox]{appearance:none;-webkit-appearance:none;height:var(--checkbox-size);width:var(--checkbox-size);border-radius:var(--widget-border-radius);text-align:center}.lil-gui input[type=checkbox]:checked:before{font-family:"lil-gui";content:"✓";font-size:var(--checkbox-size);line-height:var(--checkbox-size)}@media(hover: hover){.lil-gui input[type=checkbox]:focus{box-shadow:inset 0 0 0 1px var(--focus-color)}}.lil-gui button{-webkit-tap-highlight-color:transparent;outline:none;cursor:pointer;font-family:var(--font-family);font-size:var(--font-size);color:var(--text-color);width:100%;height:var(--widget-height);text-transform:none;background:var(--widget-color);border-radius:var(--widget-border-radius);border:1px solid var(--widget-color);text-align:center;line-height:calc(var(--widget-height)*.725)}@media(hover: hover){.lil-gui button:hover{background:var(--hover-color);border-color:var(--hover-color)}.lil-gui button:focus{border-color:var(--focus-color)}}.lil-gui button:active{background:var(--focus-color)}@font-face{font-family:"lil-gui";src:url("data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAUsAAsAAAAACJwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAAH4AAADAImwmYE9TLzIAAAGIAAAAPwAAAGBKqH5SY21hcAAAAcgAAAD0AAACrukyyJBnbHlmAAACvAAAAF8AAACEIZ5WI2hlYWQAAAMcAAAAJwAAADZfcj23aGhlYQAAA0QAAAAYAAAAJAC5AHhobXR4AAADXAAAABAAAABMAZAAAGxvY2EAAANsAAAAFAAAACgCEgIybWF4cAAAA4AAAAAeAAAAIAEfABJuYW1lAAADoAAAASIAAAIK9SUU/XBvc3QAAATEAAAAZgAAAJCTcMc2eJxVjbEOgjAURU+hFRBK1dGRL+ALnAiToyMLEzFpnPz/eAshwSa97517c/MwwJmeB9kwPl+0cf5+uGPZXsqPu4nvZabcSZldZ6kfyWnomFY/eScKqZNWupKJO6kXN3K9uCVoL7iInPr1X5baXs3tjuMqCtzEuagm/AAlzQgPAAB4nGNgYRBlnMDAysDAYM/gBiT5oLQBAwuDJAMDEwMrMwNWEJDmmsJwgCFeXZghBcjlZMgFCzOiKOIFAB71Bb8AeJy1kjFuwkAQRZ+DwRAwBtNQRUGKQ8OdKCAWUhAgKLhIuAsVSpWz5Bbkj3dEgYiUIszqWdpZe+Z7/wB1oCYmIoboiwiLT2WjKl/jscrHfGg/pKdMkyklC5Zs2LEfHYpjcRoPzme9MWWmk3dWbK9ObkWkikOetJ554fWyoEsmdSlt+uR0pCJR34b6t/TVg1SY3sYvdf8vuiKrpyaDXDISiegp17p7579Gp3p++y7HPAiY9pmTibljrr85qSidtlg4+l25GLCaS8e6rRxNBmsnERunKbaOObRz7N72ju5vdAjYpBXHgJylOAVsMseDAPEP8LYoUHicY2BiAAEfhjAGJgZWBgZ7RnFRdnVJELCRlBSRlATJMoLV2DK4glSYs6ubq5vbKrJLSbGrgEmovDuDJVhe3VzcXFwNLCOILB/C4IuQ1xTn5FPilBTj5FPmBAB76woyAHicY2BkYGAA4sklsQ/j+W2+MnAzpDBgAyEMYUCSg4EJxAEAvVwFCgB4nGNgZGBgSGFggJMhDIwMqEAYAByHATJ4nGNgAIIUNEwmAABl3AGReJxjYAACIQYlBiMGJ3wQAEcQBEV4nGNgZGBgEGZgY2BiAAEQyQWEDAz/wXwGAAsPATIAAHicXdBNSsNAHAXwl35iA0UQXYnMShfS9GPZA7T7LgIu03SSpkwzYTIt1BN4Ak/gKTyAeCxfw39jZkjymzcvAwmAW/wgwHUEGDb36+jQQ3GXGot79L24jxCP4gHzF/EIr4jEIe7wxhOC3g2TMYy4Q7+Lu/SHuEd/ivt4wJd4wPxbPEKMX3GI5+DJFGaSn4qNzk8mcbKSR6xdXdhSzaOZJGtdapd4vVPbi6rP+cL7TGXOHtXKll4bY1Xl7EGnPtp7Xy2n00zyKLVHfkHBa4IcJ2oD3cgggWvt/V/FbDrUlEUJhTn/0azVWbNTNr0Ens8de1tceK9xZmfB1CPjOmPH4kitmvOubcNpmVTN3oFJyjzCvnmrwhJTzqzVj9jiSX911FjeAAB4nG3HMRKCMBBA0f0giiKi4DU8k0V2GWbIZDOh4PoWWvq6J5V8If9NVNQcaDhyouXMhY4rPTcG7jwYmXhKq8Wz+p762aNaeYXom2n3m2dLTVgsrCgFJ7OTmIkYbwIbC6vIB7WmFfAAAA==") format("woff")}';const i=document.querySelector("head link[rel=stylesheet], head style");i?document.head.insertBefore(t,i):document.head.appendChild(t)}(),W=!0),r?r.appendChild(this.domElement):t&&(this.domElement.classList.add("autoPlace"),document.body.appendChild(this.domElement)),i&&this.domElement.classList.add("allow-touch-styles"),a&&this.domElement.style.setProperty("--width",a+"px")}add(e,t,i,r,n){if(Object(i)===i)return new X(this,e,t,i);const o=e[t];switch(typeof o){case"number":return new Y(this,e,t,i,r,n);case"boolean":return new $(this,e,t);case"string":return new H(this,e,t);case"function":return new I(this,e,t)}console.error(`Failed to add controller for "${t}"`,o,e)}addColor(e,t,i=1){return new L(this,e,t,i)}addFolder(e){return new N({parent:this,title:e})}load(e,t=!0){if(!("controllers"in e))throw new Error('Invalid load object. Should contain a "controllers" key.');return this.controllers.forEach((t=>{t instanceof I||t._name in e.controllers&&t.load(e.controllers[t._name])})),t&&e.folders&&this.folders.forEach((t=>{t._title in e.folders&&t.load(e.folders[t._title])})),this}save(e=!0){const t={controllers:{},folders:{}};return this.controllers.forEach((e=>{if(!(e instanceof I)){if(e._name in t.controllers)throw new Error(`Cannot save GUI with duplicate property "${e._name}"`);t.controllers[e._name]=e.save()}})),e&&this.folders.forEach((e=>{if(e._title in t.folders)throw new Error(`Cannot save GUI with duplicate folder "${e._title}"`);t.folders[e._title]=e.save()})),t}open(e=!0){return this._closed=!e,this.$title.setAttribute("aria-expanded",!this._closed),this.domElement.classList.toggle("closed",this._closed),this}close(){return this.open(!1)}openAnimated(e=!0){return this._closed=!e,this.$title.setAttribute("aria-expanded",!this._closed),requestAnimationFrame((()=>{const t=this.$children.clientHeight;this.$children.style.height=t+"px",this.domElement.classList.add("transition");const i=e=>{e.target===this.$children&&(this.$children.style.height="",this.domElement.classList.remove("transition"),this.$children.removeEventListener("transitionend",i))};this.$children.addEventListener("transitionend",i);const r=e?this.$children.scrollHeight:0;this.domElement.classList.toggle("closed",!e),requestAnimationFrame((()=>{this.$children.style.height=r+"px"}))})),this}title(e){return this._title=e,this.$title.innerHTML=e,this}reset(e=!0){return(e?this.controllersRecursive():this.controllers).forEach((e=>e.reset())),this}onChange(e){return this._onChange=e,this}_callOnChange(e){this.parent&&this.parent._callOnChange(e),void 0!==this._onChange&&this._onChange.call(this,{object:e.object,property:e.property,value:e.getValue(),controller:e})}destroy(){this.parent&&(this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.folders.splice(this.parent.folders.indexOf(this),1)),this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement),Array.from(this.children).forEach((e=>e.destroy())),this._onResize&&window.removeEventListener("resize",this._onResize)}controllersRecursive(){let e=Array.from(this.controllers);return this.folders.forEach((t=>{e=e.concat(t.controllersRecursive())})),e}foldersRecursive(){let e=Array.from(this.folders);return this.folders.forEach((t=>{e=e.concat(t.foldersRecursive())})),e}}function Z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Q(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var K=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.target,r=void 0===i?window:i,n=t.width,o=void 0===n?window.innerWidth:n,a=t.height,s=void 0===a?window.innerHeight:a,l=t.margin,u=void 0===l?.02:l,c=t.marginTop,h=t.marginRight,d=t.marginBottom,f=t.marginLeft,p=t.enabled,v=void 0===p||p,m=t.debug,g=void 0!==m&&m,b=t.onChange;Z(this,e);var y=function(e){return"number"==typeof e&&e>=0?e:u};this.margin={top:y(c),right:y(h),bottom:y(d),left:y(f)},this.hitbox={top:this.margin.top,left:this.margin.left,width:o,height:s},this.resize(o,s),this.x=this.y=.5,this.target=r,this.onMouseMove=function(e){e.preventDefault&&e.preventDefault(),this.track(e.clientX,e.clientY)}.bind(this),this.onTouchMove=function(e){e.preventDefault(),this.onMouseMove(e.targetTouches[0])}.bind(this),this.onChange=b,g&&(this.onDebug=this.log),v&&this.enable()}var t,i,r;return t=e,(i=[{key:"enable",value:function(){this._enabled||(this.target.addEventListener("touchmove",this.onTouchMove),this.target.addEventListener("mousemove",this.onMouseMove),this._enabled=!0)}},{key:"disable",value:function(){this._enabled&&(this.target.removeEventListener("touchmove",this.onTouchMove),this.target.removeEventListener("mousemove",this.onMouseMove),this._enabled=!1)}},{key:"dispose",value:function(){this.disable()}},{key:"track",value:function(e,t){var i,r,n;if(this.clientX!==e){this.clientX=e;var o=this.normalizeX;this.x!==o&&(this.x=o,n=!0)}if(this.clientY!==t){this.clientY=t;var a=this.normalizeY;this.y!==a&&(this.y=a,n=!0)}n&&(null===(i=this.onChange)||void 0===i||i.call(this),null===(r=this.onDebug)||void 0===r||r.call(this))}},{key:"resize",value:function(e,t){var i=this.margin.left*e,r=this.margin.right*e;this.hitbox.width=e-i-r,this.offsetX=i;var n=this.margin.top*t,o=this.margin.bottom*t;this.hitbox.height=t-n-o,this.offsetY=n}},{key:"log",value:function(){var e=this.x,t=this.y,i=this.reverseX,r=this.reverseY,n=this.polarizeX,o=this.polarizeY,a=this.reversePolarizeX,s=this.reversePolarizeY,l=this.centerX,u=this.centerY,c=this.reverseCenterX,h=this.reverseCenterY;console.log({x:e,y:t,reverseX:i,reverseY:r,polarizeX:n,polarizeY:o,reversePolarizeX:a,reversePolarizeY:s,centerX:l,centerY:u,reverseCenterX:c,reverseCenterY:h})}},{key:"normalizeX",get:function(){return e.normalize(this.clientX-this.offsetX,this.hitbox.width)}},{key:"normalizeY",get:function(){return e.normalize(this.clientY-this.offsetY,this.hitbox.height)}},{key:"reverseX",get:function(){return e.reverse(this.x)}},{key:"reverseY",get:function(){return e.reverse(this.y)}},{key:"polarizeX",get:function(){return e.polarize(this.x)}},{key:"polarizeY",get:function(){return e.polarize(this.y)}},{key:"reversePolarizeX",get:function(){return e.reversePolarize(this.x)}},{key:"reversePolarizeY",get:function(){return e.reversePolarize(this.y)}},{key:"centerX",get:function(){return e.center(this.x)}},{key:"centerY",get:function(){return e.center(this.y)}},{key:"reverseCenterX",get:function(){return e.reverseCenter(this.x)}},{key:"reverseCenterY",get:function(){return e.reverseCenter(this.y)}}])&&Q(t.prototype,i),r&&Q(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();K.clamp=function(e){return e>1?1:e<0?0:e},K.normalize=function(e,t){return K.clamp(e/t)},K.reverse=function(e){return 1-e},K.polarize=function(e){return 2*e-1},K.reversePolarize=function(e){return 1-2*e},K.center=function(e){return 1-2*Math.abs(e-.5)},K.reverseCenter=function(e){return 2*Math.abs(e-.5)};const J=[];for(let e=0;e<256;e++)J[e]=(e<16?"0":"")+e.toString(16);Math.PI,Math.PI;function q(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ee(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var te=function(){function t(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.lookAt,o=void 0===n?{x:0,y:0,z:0}:n,a=r.bounds,s=void 0===a?{x:5,y:5,z:0}:a,l=r.speed,u=void 0===l?.002:l;q(this,t),this.camera=i,this.lookAt=new e.Vector3(o.x,o.y,o.z),this.bounds=new e.Vector3(s.x,s.y,s.z),this.speed=u,this.target=new e.Vector3,this.origin=(new e.Vector3).copy(i.position)}var i,r,n;return i=t,r=[{key:"set",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.camera.position.set(e,t,i),this}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.target.x=this.origin.x+this.bounds.x*e,this.target.y=this.origin.y+this.bounds.y*t,this.target.z=this.origin.z+this.bounds.z*i,this}},{key:"tick",value:function(e){var t,i,r,n=(t=this.speed*e,i=0,r=1,Math.max(i,Math.min(r,t)));return this.camera.position.lerp(this.target,n),this.camera.lookAt(this.lookAt),this}}],r&&ee(i.prototype,r),n&&ee(i,n),Object.defineProperty(i,"prototype",{writable:!1}),t}();function ie(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function re(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ne=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.cameraRig,n=void 0===r||r,o=i.tracker,a=void 0===o||o;ie(this,e),this.sketch=t,a&&this.initTracker(),n&&this.initCamera(),t.settings.gui&&this.initGUI()}var t,i,r;return t=e,(i=[{key:"initTracker",value:function(){this.tracker=new K,this.trackerEnabled=!0}},{key:"initCamera",value:function(){var e=this.sketch,t=e.settings,i=e.stage,r=t.cameraLookAt,n=t.cameraBounds,o=t.cameraLerpSpeed,a=t.cameraIntro;this.cameraRig=new te(i.camera,{lookAt:r,bounds:n,speed:o,intro:a}),this.cameraRigEnabled=!0}},{key:"initGUI",value:function(){this.gui=new N}},{key:"resize",value:function(e,t){var i;null===(i=this.tracker)||void 0===i||i.resize(e,t)}},{key:"tick",value:function(e){this.cameraRigEnabled&&this.cameraRig.update(this.tracker.reversePolarizeX,this.tracker.y).tick(e)}}])&&re(t.prototype,i),r&&re(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function oe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ae(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}ne.GUI=N,ne.GUI_MINIFY_BREAKPOINT=1e3,ne.VALUE="value",ne.clamp=e.MathUtils.clamp,ne.lerp=e.MathUtils.lerp;var se=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=i.background,n=i.camera,o=void 0===n?new e.PerspectiveCamera:n,a=i.cameraNear,s=void 0===a?.1:a,l=i.cameraFar,u=void 0===l?1e3:l,c=i.cameraFov,h=void 0===c?50:c,d=i.cameraStart,f=void 0===d?{x:10,y:10,z:10}:d,p=i.cameraLookAt,v=void 0===p?{x:0,y:0,z:0}:p;oe(this,t),this.scene=new e.Scene,r&&(this.scene.background=r),o.near=s,o.far=u,o.fov=h,f&&o.position.set(f.x,f.y,f.z),v&&o.lookAt(v.x,v.y,v.z),this.camera=o}var i,r,n;return i=t,(r=[{key:"add",value:function(e){this.scene.add(e)}},{key:"remove",value:function(e){this.scene.remove(e)}},{key:"resize",value:function(e,t){this.camera.aspect=e/t,this.camera.updateProjectionMatrix()}}])&&ae(i.prototype,r),n&&ae(i,n),Object.defineProperty(i,"prototype",{writable:!1}),t}();function le(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function ue(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?le(Object(i),!0).forEach((function(t){ce(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):le(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function ce(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function he(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function de(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var fe=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.defaults,r=void 0===i?{}:i,n=e.settings,o=void 0===n?{}:n,l=e.stage,u=e.background,c=e.camera,h=e.random;he(this,t),o=ue(ue({},r),o),this.settings=o,l||(l=new se(ue(ue({},o),{},{background:u,camera:c}))),this.stage=l;var d=o.sketchpad||new a;this.sketchpad=d,this.effects=new D({renderer:d.renderer,stage:l}),this.random=h||o.random?new s:null,!u&&o.background&&this.buildBackground()}var i,r,n;return i=t,r=[{key:"buildBackground",value:function(){var t=this.settings.background,i=t instanceof e.Color?t:("string"==typeof t||"number"==typeof t)&&new e.Color(t);if(i)return this.stage.background=i;t.color1&&t.color2&&(this.background=new y(t),this.add(this.background))}},{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ne;this.build(),e&&(this.controls=new e(this))}},{key:"build",value:function(){}},{key:"dispose",value:function(){this.stage.dispose(),this.effects.dispose()}},{key:"resize",value:function(e,t,i){var r,n;this.stage.resize(e,t),null===(r=this.controls)||void 0===r||r.resize(e,t),null===(n=this.effects)||void 0===n||n.resize(e,t,i)}},{key:"tick",value:function(e,t){var i;null===(i=this.controls)||void 0===i||i.tick(e,t),this.effects.tick(e,t)}},{key:"add",value:function(e){this.stage.add(e)}},{key:"remove",value:function(e){this.stage.remove(e)}},{key:"camera",get:function(){return this.stage.camera}},{key:"debug",get:function(){return this.sketchpad.debug}}],r&&de(i.prototype,r),n&&de(i,n),Object.defineProperty(i,"prototype",{writable:!1}),t}();const pe={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new e.Color(0)},defaultOpacity:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec3 defaultColor;\n\t\tuniform float defaultOpacity;\n\t\tuniform float luminosityThreshold;\n\t\tuniform float smoothWidth;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\n\t\t\tvec3 luma = vec3( 0.299, 0.587, 0.114 );\n\n\t\t\tfloat v = dot( texel.xyz, luma );\n\n\t\t\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n\n\t\t\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n\n\t\t\tgl_FragColor = mix( outputColor, texel, alpha );\n\n\t\t}"};class ve extends w{constructor(t,i,r,n){super(),this.strength=void 0!==i?i:1,this.radius=r,this.threshold=n,this.resolution=void 0!==t?new e.Vector2(t.x,t.y):new e.Vector2(256,256),this.clearColor=new e.Color(0,0,0);const o={minFilter:e.LinearFilter,magFilter:e.LinearFilter,format:e.RGBAFormat};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let a=Math.round(this.resolution.x/2),s=Math.round(this.resolution.y/2);this.renderTargetBright=new e.WebGLRenderTarget(a,s,o),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let t=0;t<this.nMips;t++){const i=new e.WebGLRenderTarget(a,s,o);i.texture.name="UnrealBloomPass.h"+t,i.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(i);const r=new e.WebGLRenderTarget(a,s,o);r.texture.name="UnrealBloomPass.v"+t,r.texture.generateMipmaps=!1,this.renderTargetsVertical.push(r),a=Math.round(a/2),s=Math.round(s/2)}void 0===pe&&console.error("THREE.UnrealBloomPass relies on LuminosityHighPassShader");const l=pe;this.highPassUniforms=e.UniformsUtils.clone(l.uniforms),this.highPassUniforms.luminosityThreshold.value=n,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new e.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,defines:{}}),this.separableBlurMaterials=[];const u=[3,5,7,9,11];a=Math.round(this.resolution.x/2),s=Math.round(this.resolution.y/2);for(let t=0;t<this.nMips;t++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(u[t])),this.separableBlurMaterials[t].uniforms.texSize.value=new e.Vector2(a,s),a=Math.round(a/2),s=Math.round(s/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=i,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new e.Vector3(1,1,1),new e.Vector3(1,1,1),new e.Vector3(1,1,1),new e.Vector3(1,1,1),new e.Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===x&&console.error("THREE.UnrealBloomPass relies on CopyShader");const c=x;this.copyUniforms=e.UniformsUtils.clone(c.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new e.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,blending:e.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new e.Color,this.oldClearAlpha=1,this.basic=new e.MeshBasicMaterial,this.fsQuad=new _(null)}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()}setSize(t,i){let r=Math.round(t/2),n=Math.round(i/2);this.renderTargetBright.setSize(r,n);for(let t=0;t<this.nMips;t++)this.renderTargetsHorizontal[t].setSize(r,n),this.renderTargetsVertical[t].setSize(r,n),this.separableBlurMaterials[t].uniforms.texSize.value=new e.Vector2(r,n),r=Math.round(r/2),n=Math.round(n/2)}render(e,t,i,r,n){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const o=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),n&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=i.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=i.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let a=this.renderTargetBright;for(let t=0;t<this.nMips;t++)this.fsQuad.material=this.separableBlurMaterials[t],this.separableBlurMaterials[t].uniforms.colorTexture.value=a.texture,this.separableBlurMaterials[t].uniforms.direction.value=ve.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[t]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[t].uniforms.colorTexture.value=this.renderTargetsHorizontal[t].texture,this.separableBlurMaterials[t].uniforms.direction.value=ve.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[t]),e.clear(),this.fsQuad.render(e),a=this.renderTargetsVertical[t];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,n&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(i),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=o}getSeperableBlurMaterial(t){return new e.ShaderMaterial({defines:{KERNEL_RADIUS:t,SIGMA:t},uniforms:{colorTexture:{value:null},texSize:{value:new e.Vector2(.5,.5)},direction:{value:new e.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\n\t\t\t\tuniform vec2 direction;\n\n\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\n\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\n\t\t\t\t}\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\n\t\t\t\t\tfloat fSigma = float(SIGMA);\n\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\n\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\n\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat x = float(i);\n\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\n\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\n\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\n\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\n\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\n\t\t\t\t\t\tweightSum += 2.0 * w;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})}getCompositeMaterial(t){return new e.ShaderMaterial({defines:{NUM_MIPS:t},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform sampler2D dirtTexture;\n\t\t\t\tuniform float bloomStrength;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\n\t\t\t\tfloat lerpBloomFactor(const in float factor) {\n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n\t\t\t\t}"})}}ve.BlurDirectionX=new e.Vector2(1,0),ve.BlurDirectionY=new e.Vector2(0,1);Math.PI;function me(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ge=function(){function t(i,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n||(n=r),this.camera=i,this.near=r,this.far=n,this.depth=Math.abs(n-r),this.x=new e.Vector3,this.y=new e.Vector3,this.z=new e.Vector3}var i,r,n;return i=t,(r=[{key:"update",value:function(){var e=this.getVisibleHeight(this.far),t=e*this.camera.aspect;this.height=e,this.width=t,this.left=.5*-t,this.right=.5*t,this.top=.5*e,this.bottom=.5*-e,this.x.set(this.left,this.right,this.width),this.y.set(this.bottom,this.top,this.height),this.z.set(this.far,this.near,this.depth),this.needsUpdate=!1}},{key:"getVisibleHeight",value:function(e){return t.getVisibleHeight(this.camera,e)}},{key:"getVisibleWidth",value:function(e){return t.getVisibleWidth(this.camera,e)}}])&&me(i.prototype,r),n&&me(i,n),Object.defineProperty(i,"prototype",{writable:!1}),t}();ge.getVisibleHeight=function(e,t){var i=e.position.z;void 0===t&&(t=i),t+=t<i?-i:i;var r=e.fov*Math.PI/180;return 2*Math.tan(r/2)*Math.abs(t)},ge.getVisibleWidth=function(e,t){return ge.getVisibleHeight(e,t)*e.aspect};const be="//\tSimplex 3D Noise \n//\tby Ian McEwan, Ashima Arts\n//\nvec4 permute( vec4 x ){ return mod( ( ( x * 34.0 ) + 1.0 ) * x, 289.0 ); }\nvec4 taylorInvSqrt( vec4 r ){ return 1.79284291400159 - 0.85373472095314 * r; }\n\nfloat simplex3D( float vx, float vy, float vz ) {\n\n\tvec3 v = vec3( vx, vy, vz );\n\t\n\tconst vec2 C = vec2( 1.0/6.0, 1.0/3.0   );\n\tconst vec4 D = vec4( 0.0, 0.5, 1.0, 2.0 );\n\n\t// First corner\n\tvec3 i  = floor( v + dot( v, C.yyy ) );\n\tvec3 x0 =   v - i + dot( i, C.xxx ) ;\n\n\t// Other corners\n\tvec3 g = step( x0.yzx, x0.xyz );\n\tvec3 l = 1.0 - g;\n\tvec3 i1 = min(  g.xyz, l.zxy );\n\tvec3 i2 = max(  g.xyz, l.zxy );\n\n\t// x0 = x0 - 0. + 0.0 * C \n\tvec3 x1 = x0 - i1 + 1.0 * C.xxx;\n\tvec3 x2 = x0 - i2 + 2.0 * C.xxx;\n\tvec3 x3 = x0 - 1. + 3.0 * C.xxx;\n\n\t// Permutations\n\ti = mod( i, 289.0 ); \n\tvec4 p = permute( permute( permute(\n\t\t\t i.z + vec4( 0.0, i1.z, i2.z, 1.0 ) )\n\t\t   + i.y + vec4( 0.0, i1.y, i2.y, 1.0 ) ) \n\t\t   + i.x + vec4( 0.0, i1.x, i2.x, 1.0 ) );\n\n\t// Gradients\n\t// ( N*N points uniformly over a square, mapped onto an octahedron.)\n  \tfloat n_ = 1.0/7.0; // N=7\n  \tvec3  ns = n_ * D.wyz - D.xzx;\n\n  \tvec4 j = p - 49.0 * floor( p * ns.z *ns.z ); //  mod( p,N*N)\n\n  \tvec4 x_ = floor( j * ns.z );\n  \tvec4 y_ = floor( j - 7.0 * x_ ); // mod( j,N)\n\n  \tvec4 x = x_ *ns.x + ns.yyyy;\n  \tvec4 y = y_ *ns.x + ns.yyyy;\n  \tvec4 h = 1.0 - abs( x ) - abs( y );\n\n  \tvec4 b0 = vec4( x.xy, y.xy );\n  \tvec4 b1 = vec4( x.zw, y.zw );\n\n  \tvec4 s0 = floor( b0 )*2.0 + 1.0;\n  \tvec4 s1 = floor( b1 )*2.0 + 1.0;\n  \tvec4 sh = -step( h, vec4( 0.0 ) );\n\n  \tvec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  \tvec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  \tvec3 p0 = vec3( a0.xy,h.x );\n  \tvec3 p1 = vec3( a0.zw,h.y );\n  \tvec3 p2 = vec3( a1.xy,h.z );\n  \tvec3 p3 = vec3( a1.zw,h.w );\n\n\t// Normalise gradients\n  \tvec4 norm = taylorInvSqrt( \n\t\tvec4( dot( p0, p0 ), dot( p1, p1 ), dot( p2, p2 ), dot( p3, p3 ) )\n\t);\n  \tp0 *= norm.x;\n  \tp1 *= norm.y;\n  \tp2 *= norm.z;\n  \tp3 *= norm.w;\n\n\t// Mix final noise value\n  \tvec4 m = max( \n\t\t0.6 - vec4( dot( x0, x0 ), dot( x1, x1 ), dot( x2, x2 ), dot( x3, x3 ) ), \n\t\t0.0\n\t);\n  \tm = m * m;\n  \treturn 42.0 * dot( \n\t\tm*m,\n\t\tvec4( dot( p0,x0 ), dot( p1,x1 ), dot( p2,x2 ), dot( p3,x3 ) )\n\t);\n\n}";function ye(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function xe(e,t,i){return t&&ye(e.prototype,t),i&&ye(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var we=xe((function t(i,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r||(r=Te.getTextureSize(i.length));var n=Te.createDataTexture(r);return n.needsUpdate=!0,Te.FloatPack.pack(i,n.image.data),new e.Uniform(n)}));var Ae={glsl:"\n\nvec4 packFloat( float value ) {\n\n\tif ( value == 0.0 ) return vec4( 0.0, 0.0, 0.0, 0.0 );\n\n\tfloat mag = abs( value );\n\t\n\tfloat exponent = floor( log2( mag ) );\n\texponent += float( exp2( exponent ) <= mag / 2.0 );\n\texponent -= float( exp2( exponent ) > mag );\n\n\tfloat mantissa = ( exponent > 100.0 )\n\t\t? mag / 1024.0 / exp2( exponent - 10.0 ) - 1.0\n\t\t: mag / float( exp2( exponent ) ) - 1.0;\n\n\tfloat r = exponent + 127.0;\n\tmantissa *= 256.0;\n\n\tfloat g = floor( mantissa );\n\tmantissa -= g;\n\tmantissa *= 256.0;\n\n\tfloat b = floor( mantissa );\n\tmantissa -= b;\n\tmantissa *= 128.0;\n\n\tfloat a = floor( mantissa ) * 2.0 + float( value < 0.0 );\n\n\treturn vec4( r, g, b, a ) / 255.0;\n\n}\n\nfloat unpackFloat( vec4 value ) {\n\n\tfloat r = floor( value.r * 255.0 + 0.5 );\n\tfloat g = floor( value.g * 255.0 + 0.5 );\n\tfloat b = floor( value.b * 255.0 + 0.5 );\n\tfloat a = floor( value.a * 255.0 + 0.5 );\n\n\tfloat exponent = r - 127.0;\n\tfloat sign = 1.0 - mod( a, 2.0 ) * 2.0;\n\tfloat mantissa = float( r > 0.0 ) + g / 256.0 + b / 65536.0\n\t\t+ floor( a / 2.0 ) / 8388608.0;\n\treturn sign * mantissa * exp2( exponent );\n\n}\n\n",pack:function(e,t){var i,r,n,o,a,s,l;t||(t=new Uint8Array(4*e.length));for(var u=0,c=0,h=e.length;u<h;u++)0!==(i=e[u])&&(r=Math.abs(i),n=Math.floor(Math.log2(r)),n+=(o=Math.pow(2,n))<=r/2,a=(n-=o>r)>100?r/1024/Math.pow(2,n-10)-1:r/o-1,t[c]=n+127,a*=256,s=Math.floor(a),t[c+1]=s,a=256*(a-s),l=Math.floor(a),t[c+2]=l,a=128*(a-l),t[c+3]=2*Math.floor(a)+(i<0)),c+=4;return t},unpack:function(e,t){var i,r,n,o,a,s;t||(t=new Float32Array(e.length/4));for(var l=0,u=0,c=e.length;l<c;l+=4)i=e[l],r=e[l+1],n=e[l+2],a=i-127,s=(1-(o=e[l+3])%2*2)*((i>0)+r/256+n/65536+Math.floor(o/2)/8388608)*Math.pow(2,a),t[u]=s,u++}};function ke(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ce=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=i.data,n=i.defaultValue,o=i.textureSize,a=i.length,s=void 0===a?65536:a,l=i.name,u=void 0===l?"data":l,c=i.prefix,h=void 0===c?"GPGPU_":c,d=i.shader,f=void 0===d?t.fragmentShader:d,p=i.uniforms,v=void 0===p?{}:p;if(ke(this,t),!Te.renderer)throw new Error("Use GPUVariable.init( renderer ) before instancing.");r?s=r.length:o&&(s=o*o),o||(o=Te.getTextureSize(s)),this.textureSize=o,this.rt1=Te.createRenderTarget(o),this.rt2=Te.createRenderTarget(o),this.renderTarget=this.rt1,this.dataTexture=Te.createDataTexture(o),this.dataTexture.needsUpdate=!0,r?this.write(r):(r=this.createDataArray(n),n&&this.write(r)),this.output=new e.Uniform(this.dataTexture),this.name=h?h+u:u,this.uniforms=v,this.uniforms[this.name]=this.output,this.material=new e.ShaderMaterial({uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:f});var m=o.toFixed(1);this.material.defines.resolution="vec2( ".concat(m,", ").concat(m," )")}var i,r,n;return i=t,(r=[{key:"update",value:function(){this.renderTarget=this.renderTarget===this.rt1?this.rt2:this.rt1,Te.render(this.material,this.renderTarget),this.output.value=this.renderTarget.texture}},{key:"dispose",value:function(){this.rt1.dispose(),this.rt2.dispose(),this.dataTexture.dispose(),this.material.dispose()}},{key:"createDataArray",value:function(e){var t=new Float32Array(this.textureSize*this.textureSize);return e&&t.fill(e),t}},{key:"read",value:function(){Te.renderer.readRenderTargetPixels(this.renderTarget,0,0,this.textureSize,this.textureSize,this.buffer);var e=this.createDataArray();return Ae.unpack(this.buffer,e),e}},{key:"write",value:function(e){Ae.pack(e,this.buffer)}},{key:"buffer",get:function(){return this.dataTexture.image.data}}])&&_e(i.prototype,r),n&&_e(i,n),Object.defineProperty(i,"prototype",{writable:!1}),t}();function Se(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function Pe(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Se(Object(i),!0).forEach((function(t){Ee(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Se(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Ee(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Ve(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Ce.vertexShader="\n    void main() {\n\n        gl_Position = vec4( position, 1.0 );\n\n    }\n",Ce.fragmentShader="\n    uniform sampler2D GPGPU_data;\n\n    ".concat(Ae.glsl,"\n\n    void main() {\n        \n        vec2 uv = gl_FragCoord.xy / resolution.xy;\n        float data = unpackFloat( texture2D( GPGPU_data, uv ) );\n\n        // Modify data...\n\n        gl_FragColor = packFloat( data );\n\n    }\n");var Te=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._textureSize=e.getTextureSize(t),this.variables={}}var t,i,r;return t=e,i=[{key:"addVariable",value:function(e,t){var i=new Ce(Pe(Pe({},t),{},{name:e,textureSize:this._textureSize}));this.variables[e]=i,this[e]=i.output}},{key:"addConstant",value:function(e,t){this[e]=new we(t,this._textureSize)}},{key:"assign",value:function(e,t){var i=this.variables[e],r=this.variables[t];i.uniforms[r.name]=r.output}},{key:"tick",value:function(){Object.values(this.variables).forEach((function(e){return e.update()}))}},{key:"textureSize",get:function(){return this._textureSize}}],i&&Ve(t.prototype,i),r&&Ve(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();Te.init=function(t){if(!Te.renderer){Te.renderer=t;Te.isSupported=!0,Te.renderer.capabilities.maxVertexTextures||(console.warn("No support for vertex textures."),Te.isSupported=!1),Te.isSupported||window.alert("Incompatible hardware."),Te.isSupported&&(Te.renderer=t,Te.scene=new e.Scene,Te.camera=new e.OrthographicCamera,Te.mesh=new e.Mesh(new e.PlaneGeometry(2,2)),Te.scene.add(Te.mesh))}},Te.getTextureSize=function(e){if(isNaN(e)||!isFinite(e)||!Number.isInteger(e)||e<1)throw new RangeError("Parameter must be an int > 0 ");for(var t=1,i=2;i*i<e;)i=Math.pow(2,t),t++;return i},Te.createDataTexture=function(t){return new e.DataTexture(new Uint8Array(t*t*4),t,t,e.RGBAFormat,e.UnsignedByteType)},Te.createRenderTarget=function(t){return new e.WebGLRenderTarget(t,t,{wrapS:e.ClampToEdgeWrapping,wrapT:e.ClampToEdgeWrapping,minFilter:e.NearestFilter,magFilter:e.NearestFilter,stencilBuffer:!1,depthBuffer:!1,format:e.RGBAFormat,type:e.UnsignedByteType})},Te.render=function(e,t){Te.mesh.material=e,Te.renderer.setRenderTarget(t),Te.renderer.render(Te.scene,Te.camera),Te.renderer.setRenderTarget(null)},Te.FloatPack=Ae;const ze="float loopValue( float value, float minimum, float change ) {\r\n\r\n\treturn minimum + mod( value - minimum, change );\r\n\r\n}";"\nuniform sampler2D GPGPU_x;\nuniform sampler2D GPGPU_y;\nuniform sampler2D GPGPU_z;\nuniform float uEpsilon;\nuniform float uCurlScale;\nuniform float uCurlSpeed;\nuniform float uDelta;\nuniform float uTime;\nuniform vec3 uBounds;\nuniform vec3 uCurlStrength;\nuniform vec3 uWind;\n".concat(Ae.glsl,"\n").concat(ze,"\n").concat(be,"\n\nvoid main() {\n\t\n\t// Read\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\tfloat x = unpackFloat( texture2D( GPGPU_x, uv ) );\n\tfloat y = unpackFloat( texture2D( GPGPU_y, uv ) );\n\tfloat z = unpackFloat( texture2D( GPGPU_z, uv ) );\n\n\t// Curl\n\n\tfloat scaledX = ( x + uTime ) * uCurlScale;\n\tfloat scaledY = ( y + uTime ) * uCurlScale;\n\tfloat scaledZ = ( z + uTime ) * uCurlScale;\n\n\tfloat noiseY1 = simplex3D( scaledX, scaledY + uEpsilon, scaledZ );\n\tfloat noiseY2 = simplex3D( scaledX, scaledY - uEpsilon, scaledZ );\n\tfloat noiseY = noiseY1 - noiseY2;\n\n\tfloat noiseZ1 = simplex3D( scaledX, scaledY, scaledZ + uEpsilon );\n\tfloat noiseZ2 = simplex3D( scaledX, scaledY, scaledZ - uEpsilon );\n\tfloat noiseZ = noiseZ1 - noiseZ2;\n\n\t// epsilon * 2 division applied in uCurlSpeed to save calculations\n\tfloat curl = ( noiseY - noiseZ ) * uCurlSpeed;\n\n\t// Write\n\n\tfloat wind =  uWind.x + simplex3D( uTime, uv.x * 0.1, uv.y * 0.1 );\n\tfloat noise = mix( wind, curl, uCurlStrength.x ) + uWind.x;\n\tx = mix( x, x + noise, uDelta );\n\tx = loopValue( x, uBounds.x, uBounds.z );\n\n\tgl_FragColor = packFloat( x );\n\n}\n"),"\nuniform sampler2D GPGPU_x;\nuniform sampler2D GPGPU_y;\nuniform sampler2D GPGPU_z;\nuniform float uCurlScale;\nuniform float uCurlSpeed;\nuniform float uDelta;\nuniform float uEpsilon;\nuniform vec3 uBounds;\nuniform vec3 uCurlStrength;\nuniform vec3 uWind;\n".concat(Ae.glsl,"\n").concat(ze,"\n").concat(be,"\n\nvoid main() {\n\t\n\t// Read\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\tfloat x = unpackFloat( texture2D( GPGPU_x, uv ) );\n\tfloat y = unpackFloat( texture2D( GPGPU_y, uv ) );\n\tfloat z = unpackFloat( texture2D( GPGPU_z, uv ) );\n\n\t// Curl\n\n\tfloat scaledX = x * uCurlScale;\n\tfloat scaledY = y * uCurlScale;\n\tfloat scaledZ = z * uCurlScale;\n\n\tfloat noiseZ1 = simplex3D( scaledX, scaledY, scaledZ + uEpsilon );\n\tfloat noiseZ2 = simplex3D( scaledX, scaledY, scaledZ - uEpsilon );\n\tfloat noiseZ = noiseZ1 - noiseZ2;\n\n\tfloat noiseX1 = simplex3D( scaledX + uEpsilon, scaledY, scaledZ );\n\tfloat noiseX2 = simplex3D( scaledX - uEpsilon, scaledY, scaledZ );\n\tfloat noiseX = noiseX1 - noiseX2;\n\n\tfloat curl = ( noiseZ - noiseX ) * uCurlSpeed;\n\n\t// Write\n\n\tfloat noise = mix( uWind.y, curl, uCurlStrength.y ) + uWind.y;\n\ty = mix( y, y + noise, uDelta );\n\ty = loopValue( y, uBounds.x, uBounds.z );\n\n\tgl_FragColor = packFloat( y );\n\n}\n"),"\nuniform sampler2D GPGPU_x;\nuniform sampler2D GPGPU_y;\nuniform sampler2D GPGPU_z;\nuniform float uCurlScale;\nuniform float uCurlSpeed;\nuniform float uDelta;\nuniform float uEpsilon;\nuniform vec3 uBounds;\nuniform vec3 uCurlStrength;\nuniform vec3 uWind;\n".concat(Ae.glsl,"\n").concat(ze,"\n").concat(be,"\n\nvoid main() {\n\t\n\t// Read\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\tfloat x = unpackFloat( texture2D( GPGPU_x, uv ) );\n\tfloat y = unpackFloat( texture2D( GPGPU_y, uv ) );\n\tfloat z = unpackFloat( texture2D( GPGPU_z, uv ) );\n\n\t// Curl\n\n\tfloat scaledX = x * uCurlScale;\n\tfloat scaledY = y * uCurlScale;\n\tfloat scaledZ = z * uCurlScale;\n\n\tfloat noiseX1 = simplex3D( scaledX + uEpsilon, scaledY, scaledZ );\n\tfloat noiseX2 = simplex3D( scaledX - uEpsilon, scaledY, scaledZ );\n\tfloat noiseX = noiseX1 - noiseX2;\n\n\tfloat noiseY1 = simplex3D( scaledX, scaledY + uEpsilon, scaledZ );\n\tfloat noiseY2 = simplex3D( scaledX, scaledY - uEpsilon, scaledZ );\n\tfloat noiseY = noiseY1 - noiseY2;\n\n\tfloat curl = ( noiseX - noiseY ) * uCurlSpeed;\n\n\t// Write\n\n\tfloat noise = curl * uCurlStrength.z * uWind.z;\n\tz = mix( z, z + noise, uDelta );\n\tz = clamp( z, uBounds.x, uBounds.y );\n\n\tgl_FragColor = packFloat( z );\n\n}\n");function Me(e,t,i,r,n){var o="#include <common>",a="#include <begin_vertex>",s="#include <logdepthbuf_fragment>";t&&(e.vertexShader=e.vertexShader.replace(o,o+t)),i&&(e.vertexShader=e.vertexShader.replace(a,a+i)),r&&(e.fragmentShader=e.fragmentShader.replace(o,o+r)),n&&(e.fragmentShader=e.fragmentShader.replace(s,n+s))}function De(e){return De="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},De(e)}function Oe(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function $e(e,t){return $e=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},$e(e,t)}function Be(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,r=Ue(e);if(t){var n=Ue(this).constructor;i=Reflect.construct(r,arguments,n)}else i=r.apply(this,arguments);return Ge(this,i)}}function Ge(e,t){if(t&&("object"===De(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Ue(e){return Ue=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ue(e)}var je=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$e(e,t)}(a,t);var i,r,n,o=Be(a);function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=o.call(this,e,{cameraRig:!1})).intensity=.5,t.initRaycaster(),t}return i=a,r=[{key:"initRaycaster",value:function(){var t=this.sketch.settings;this.raycaster=new e.Raycaster,this.hitbox=new e.Mesh(new e.PlaneGeometry(this.sketch.size,this.sketch.size,100,100),new e.MeshBasicMaterial(t.hitbox.material)),this.sketch.add(this.hitbox);var i=t.cursor.size;this.cursor=new e.Mesh(new e.BoxGeometry(i,i,i),new e.MeshBasicMaterial(t.cursor.material)),this.sketch.add(this.cursor),this.cursor.tracker=new e.Vector3,this.sketch.debug||(this.hitbox.visible=!1,this.cursor.visible=!1)}},{key:"initGUI",value:function(){var e=this.sketch,t=e.settings,i=e.background,r=new ne.GUI({title:t.name.toUpperCase()}),n=r.addFolder("Colors");n.addColor(i,"color1").name("background1"),n.addColor(i,"color2").name("background2"),n.addColor(e,"color"),n.addColor(e,"activeColor"),window.innerWidth<ne.GUI_MINIFY_BREAKPOINT&&r.close(),this.gui=r}},{key:"tick",value:function(e){var t=this.sketch,i=this.tracker,r=this.cursor,n=this.raycaster,o=t.settings,a=ne.clamp,s=ne.lerp,l=a(o.cursor.lerpSpeed*e,0,1);r.tracker.set(i.polarizeX,i.reversePolarizeY),n.setFromCamera(r.tracker,t.camera);var u=n.intersectObjects([this.hitbox])[0];null!=u&&u.point&&r.position.lerp(null==u?void 0:u.point,l);var c=t.camera.aspect>1?i.reverseCenterX:i.reverseCenterY;this.intensity=s(this.intensity,c,.05),t.depth.value=s(.5,.1,this.intensity),t.scale.value=s(.1,1,this.intensity)}}],r&&Oe(i.prototype,r),n&&Oe(i,n),Object.defineProperty(i,"prototype",{writable:!1}),a}(ne),Fe={name:"Backgrid",background:{color1:"#0a0a0a",color2:"#1c1c21"},activeColor:"#435056",material:{color:"#22222a"},cameraStart:{x:0,y:0,z:8},hitbox:{material:{color:"#ff0000",opacity:.25,transparent:!0}},cursor:{size:.1,material:{color:"#ff0000",wireframe:!0},lerpSpeed:.01}},Re={};function Le(e){return Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Le(e)}function Ie(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ye(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Xe(){return Xe="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var r=He(e,t);if(r){var n=Object.getOwnPropertyDescriptor(r,t);return n.get?n.get.call(arguments.length<3?e:i):n.value}},Xe.apply(this,arguments)}function He(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Qe(e)););return e}function We(e,t){return We=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},We(e,t)}function Ne(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,r=Qe(e);if(t){var n=Qe(this).constructor;i=Reflect.construct(r,arguments,n)}else i=r.apply(this,arguments);return Ze(this,i)}}function Ze(e,t){if(t&&("object"===Le(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Qe(e){return Qe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Qe(e)}Re.GPGPU_intensity="\n\n\tuniform sampler2D GPGPU_intensity;\n\tuniform sampler2D GPGPU_offsetX;\n\tuniform sampler2D GPGPU_offsetY;\n\tuniform vec3 uCursor;\n\tuniform float uDelta;\n\tuniform float uScale;\n\tuniform float uTime;\n\n\t".concat(Ae.glsl,"\n\t").concat(be,"\n\n\tvoid main() {\n\t\n\t// Read\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\tfloat intensity = unpackFloat( texture2D( GPGPU_intensity, uv ) );\n\n\tfloat offsetX = unpackFloat( texture2D( GPGPU_offsetX, uv ) );\n\tfloat offsetY = unpackFloat( texture2D( GPGPU_offsetY, uv ) );\n\tvec3 offset = vec3( offsetX, offsetY, 0.0 );\n\n\t// Modify\n\n\tfloat simplex = simplex3D( offsetX * uScale, offsetY * uScale, uTime );\n\t\n\tfloat waves = simplex;\n\t\n\tfloat cursorReaction = ( 1.0 + abs( simplex ) ) * clamp(\n\t\t6.674 / ( length( uCursor - offset ) + 0.1 ),\n\t\t0.0,\n\t\t10.0\n\t) * 0.2;\n\n\tfloat targetIntensity = waves + cursorReaction;\n\n\tintensity = mix( intensity, targetIntensity, uDelta );\n\n\t// Write\n\n\tgl_FragColor = packFloat( intensity );\n\n}\n"),Re.core={},Re.core.vertexHead="\nattribute vec3 aOffset;\nattribute vec2 GPGPU_target;\nuniform sampler2D GPGPU_intensity;\nuniform float uDepth;\nvarying float vIntensity;\n".concat(Ae.glsl,"\n"),Re.core.vertexBody="\n\tfloat intensity = unpackFloat( texture2D( GPGPU_intensity, GPGPU_target ) );\n\tvIntensity = clamp( ( 1.0 + intensity ) * 0.25, 0.0, 1.0 );\n\ttransformed *= 0.2 + vIntensity;\n\ttransformed += aOffset;\n\ttransformed.z -= vIntensity * uDepth;\n",Re.core.fragmentHead="\nuniform vec3 uActiveColor;\nvarying float vIntensity;\n",Re.core.fragmentBody="\n\tdiffuseColor.rgb = mix( diffuseColor.rgb, uActiveColor, vIntensity );\n",Re.shell={},Re.shell.vertexHead="\n\tattribute vec3 aOffset;\n\tattribute vec2 GPGPU_target;\n\tuniform sampler2D GPGPU_intensity;\n\tvarying float vIntensity;\n\t".concat(Ae.glsl,"\n\n"),Re.shell.vertexBody="\n\tfloat intensity = unpackFloat( texture2D( GPGPU_intensity, GPGPU_target ) );\n\tvIntensity = clamp( ( 1.0 + intensity ) * 0.25, 0.0, 1.0 );\n\ttransformed *= intensity * 0.2;\n\ttransformed += aOffset;\n",Re.shell.fragmentHead="\n\tuniform vec3 uActiveColor;\n\tvarying float vIntensity;\n",Re.shell.fragmentBody="\n\tdiffuseColor.rgb = mix( diffuseColor.rgb, uActiveColor, vIntensity );\n";var Ke=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&We(e,t)}(a,t);var i,r,n,o=Ne(a);function a(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Ie(this,a),(e=o.call(this,{defaults:Fe,settings:t})).bounds=new ge(e.camera,-1,-3),e}return i=a,r=[{key:"init",value:function(){Xe(Qe(a.prototype),"init",this).call(this,je),this.cursor.value=this.controls.cursor.position}},{key:"build",value:function(){for(var t=this.settings,i=.04,r=i+.3,n=64,o=4096,a=new Float32Array(12288),s=new Float32Array(o),l=new Float32Array(o),u=new Float32Array(8192),c=r*n,h=0,d=0,f=0,p=0;p<n;p++)for(var v=0;v<n;v++){var m=v*r-10.709999999999999,g=10.709999999999999-p*r;s[h]=m,l[h]=g,a[f++]=m,a[f++]=g,a[f++]=0,u[d++]=h%n/n,u[d++]=~~(h/n)/n,h++}var b=new e.PlaneGeometry(i,i),y=new e.EdgesGeometry(b),x=new e.InstancedBufferGeometry;x.instanceCount=o,x.setAttribute("position",(new e.Float32BufferAttribute).copy(b.attributes.position)),x.setIndex((new e.Uint16BufferAttribute).copy(b.index)),x.setAttribute("aOffset",new e.InstancedBufferAttribute(a,3)),x.setAttribute("GPGPU_target",new e.InstancedBufferAttribute(u,2));var w=new e.MeshBasicMaterial(t.material);w.onBeforeCompile=this.editCoreShader.bind(this);var A=new e.Mesh(x,w);this.add(A),this.cores=A,y.scale(2,2,2);var k=new e.InstancedBufferGeometry;k.instanceCount=o,k.setAttribute("position",(new e.Float32BufferAttribute).copy(y.attributes.position)),k.setAttribute("aOffset",new e.InstancedBufferAttribute(a,3)),k.setAttribute("GPGPU_target",new e.InstancedBufferAttribute(u,2));var _=new e.LineBasicMaterial(t.material);_.onBeforeCompile=this.editShellShader.bind(this);var C=new e.LineSegments(k,_);this.add(C),this.shells=C,b.dispose(),y.dispose(),this.size=c,this.initGPGPU(s,l)}},{key:"initGPGPU",value:function(t,i){this.activeColor=new e.Color(this.settings.activeColor),this.color=new e.Color(this.settings.material.color),this.cores.material.color=this.color,this.shells.material.color=this.color,this.cursor=new e.Uniform,this.time=new e.Uniform(0),this.delta=new e.Uniform(0),this.scale=new e.Uniform(.2),this.depth=new e.Uniform(.3),Te.init(this.sketchpad.renderer);var r=new Te(4096);r.addConstant("offsetX",t),r.addConstant("offsetY",i),r.addVariable("intensity",{shader:Re.GPGPU_intensity,uniforms:{GPGPU_offsetX:r.offsetX,GPGPU_offsetY:r.offsetY,uCursor:this.cursor,uDelta:this.delta,uScale:this.scale,uTime:this.time}}),this.gpgpu=r,this.uniforms={GPGPU_intensity:r.intensity,uActiveColor:new e.Uniform(this.activeColor)}}},{key:"editCoreShader",value:function(e){Me(e,Re.core.vertexHead,Re.core.vertexBody,Re.core.fragmentHead,Re.core.fragmentBody),Object.assign(e.uniforms,this.uniforms),e.uniforms.uDepth=this.depth,this.coreShader=e}},{key:"editShellShader",value:function(e){Me(e,Re.shell.vertexHead,Re.shell.vertexBody,Re.shell.fragmentHead,Re.shell.fragmentBody),Object.assign(e.uniforms,this.uniforms),this.shellShader=e}},{key:"tick",value:function(e){this.delta.value=.003*e,this.time.value+=3e-4*e,this.gpgpu.tick(),Xe(Qe(a.prototype),"tick",this).call(this,e)}}],r&&Ye(i.prototype,r),n&&Ye(i,n),Object.defineProperty(i,"prototype",{writable:!1}),a}(fe),Je=new a({container:"background"}),qe={sketchpad:Je,gui:!0},et=function(){return new Ke(qe)}();Je.init(et)})();